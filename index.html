<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jingtao8a.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="this is life, full of ups and down">
<meta property="og:type" content="website">
<meta property="og:title" content="jingtao8a&#39;s blog">
<meta property="og:url" content="http://jingtao8a.github.io/index.html">
<meta property="og:site_name" content="jingtao8a&#39;s blog">
<meta property="og:description" content="this is life, full of ups and down">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="jingtao8a">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://jingtao8a.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>jingtao8a's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">jingtao8a's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/09/28/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/28/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/" class="post-title-link" itemprop="url">EWALI:a Data-aware Learned Index Schema for Efficient Writes</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-09-28 18:58:19 / Modified: 19:11:12" itemprop="dateCreated datePublished" datetime="2024-09-28T18:58:19-07:00">2024-09-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learned-Index/" itemprop="url" rel="index"><span itemprop="name">Learned Index</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a>åº”ç”¨åœºæ™¯ï¼š</h3><p>(1)æ”¯æŒè¯»å†™å·¥ä½œè´Ÿè½½,åœ¨é‡å†™å·¥ä½œè´Ÿè½½ä¸­æ€§èƒ½è¡¨ç°å¾ˆå¥½<br><br>(2)ä½¿ç”¨è½»é‡çš„light-weight data-aware data partition algorithmæ„å»ºæ¨¡å‹<br><br>(3)å½“data distributionå‘ç”Ÿå˜åŒ–ï¼ŒEWALIä¼šè‡ªåŠ¨åˆ†è£‚ç›¸å…³å¶å­èŠ‚ç‚¹ï¼Œé‡è®­ç»ƒæ¨¡å‹<br><br>(4)å¹¶é‡‡ç”¨duel bufferï¼ˆåŒç¼“å†²ï¼‰æ¥å¤„ç†æ–°æ•°æ®ï¼Œå¹¶é‡‡ç”¨å»¶è¿Ÿæ›´æ–°æœºåˆ¶åˆå¹¶æ•°æ®ï¼Œæé«˜å†™å…¥æ€§èƒ½<br></p>
<p>é—®é¢˜æè¿°ï¼š<br>ï¼ˆ1ï¼‰RMIä¸æ”¯æŒå†™æ“ä½œï¼Œæ’å…¥æ–°æ•°æ®å¯¼è‡´data distributionå˜åŒ–ï¼Œéœ€è¦é‡è®­ç»ƒæ‰€æœ‰æ¨¡å‹<br>ï¼ˆ2ï¼‰RMIæ„å»ºæ—¶é‡‡ç”¨ç»Ÿä¸€çš„æ•°æ®åˆ’åˆ†ç­–ç•¥ï¼Œæ²¡æœ‰è€ƒè™‘åˆ’åˆ†åˆ°åŒä¸€æ¨¡å‹ä¸­æ•°æ®çš„ç›¸ä¼¼æ€§ï¼Œå¯¼è‡´é¢„æµ‹ä¸å‡†ç¡®</p>
<h3 id="éš¾ç‚¹å’Œåˆ†æè¿‡ç¨‹ï¼š"><a href="#éš¾ç‚¹å’Œåˆ†æè¿‡ç¨‹ï¼š" class="headerlink" title="éš¾ç‚¹å’Œåˆ†æè¿‡ç¨‹ï¼š"></a>éš¾ç‚¹å’Œåˆ†æè¿‡ç¨‹ï¼š</h3><p>ï¼ˆ1ï¼‰ç°åœ¨æ”¯æŒå†™æ“ä½œçš„æ–¹æ³•åŒ…æ‹¬å°±åœ°æ’å…¥ï¼ˆgap arrayï¼Œéœ€è¦ç§»åŠ¨æ•°æ®æˆ–äº§ç”Ÿä¸å¿…è¦çš„ç©ºé—´å¼€é”€ï¼‰ç¼“å†²åŒºæ’å…¥ï¼ˆå‘ç”Ÿå†™å…¥é˜»å¡ï¼‰<br><br>ï¼ˆ2ï¼‰ç°å­˜çš„data-partition-algorithm<br><br>K-meansç®—æ³•ï¼ˆDabbleæ¨¡å‹ï¼‰<br><br>è´ªå¿ƒç®—æ³•ï¼ˆASLMï¼‰<br><br>Piece-wise linear functionï¼ˆPGM-iNDEX  FITing-Treeï¼‰</p>
<p>ä»¥ä¸Šä¸åŒçš„ç®—æ³•æœ‰ä¸åŒçš„è®¡ç®—å¼€é”€å’Œè¯¯å·®</p>
<h3 id="è§£å†³æ–¹æ¡ˆï¼š"><a href="#è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h3><p><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image.png" alt="img"></p>
<h4 id="Data-partition-algorithm"><a href="#Data-partition-algorithm" class="headerlink" title="Data-partition-algorithm"></a>Data-partition-algorithm</h4><p>è€ƒè™‘lower model error å’Œ time cost ä»¥åŠ memory usageé€‰æ‹©ShrinkingCone<br><br><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy.png" alt="img"><br><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%202.png" alt="img"></p>
<h4 id="DARMI-Design"><a href="#DARMI-Design" class="headerlink" title="DARMI Design"></a>DARMI Design</h4><h5 id="Model-Training"><a href="#Model-Training" class="headerlink" title="Model Training:"></a>Model Training:</h5><p>(1)non-leaf node<br>(2)leaf node</p>
<h5 id="Model-Retraining"><a href="#Model-Retraining" class="headerlink" title="Model Retraining:"></a>Model Retraining:</h5><p>å½“incremental bufferä¸segmentsåˆå¹¶åï¼Œæ”¹å˜äº†æ•°æ®åˆ†å¸ƒï¼Œåå°çº¿ç¨‹è¢«å”¤é†’è¿›è¡Œretrainingæ“ä½œ</p>
<h5 id="Node-Split"><a href="#Node-Split" class="headerlink" title="Node Split:"></a>Node Split:</h5><p>å½“ä¸€ä¸ªNodeç®¡è¾–çš„dataæ•°é‡è¶…è¿‡ä¸€å®šæ•°é‡æ—¶ï¼Œä¼šäº§ç”Ÿä»¥ä¸‹å½±å“<br>1.è¿‡å¤šçš„æ•°æ®ä¼šå¯¼è‡´é‡è®­ç»ƒçš„æ—¶å€™è¦æ‰«ææ›´å¤šçš„keyï¼Œå¢åŠ è®­ç»ƒè€—æ—¶ï¼Œé™ä½å†™æ€§èƒ½<br>2.è¿‡å¤šçš„æ•°æ®ä¹Ÿä¼šè®©çº¿æ€§æ¨¡å‹æ›´éš¾å»æ‹Ÿåˆï¼Œç²¾å‡†åº¦ä¼šä¸‹é™</p>
<p>(1)horizontal split<br>Disadvantages: result in lower prediction accuracy of parent model</p>
<p>(2)Vertical split<br>Disadvantages: increase the height of DARMI, result in high lookup time<br><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%203.png" alt="img"><br>DARMIä¼šåŠ¨æ€åœ°é€‰æ‹©ä¸¤ç§splitæ–¹å¼<br><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%204.png" alt="img"><br><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%205.png" alt="img"></p>
<h5 id="Retrain-DARMI"><a href="#Retrain-DARMI" class="headerlink" title="Retrain DARMI"></a>Retrain DARMI</h5><p>å½“DARMIçš„é«˜åº¦è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼ï¼ŒæŸ¥æ‰¾æ€§èƒ½é€€åŒ–åœ°è¿‡äºä¸¥é‡äº†ï¼Œéœ€è¦å¯¹root Nodeè¿›è¡Œé‡è®­ç»ƒï¼Œ<br>å°†æ‰€æœ‰çš„old leaf nodeçš„first keyç”¨æ¥è®­ç»ƒroot nodeçš„çº¿æ€§æ¨¡å‹ï¼ŒDARMIåˆå˜æˆtwo-layer</p>
<h4 id="Incremental-Buffer-Design"><a href="#Incremental-Buffer-Design" class="headerlink" title="Incremental Buffer Design"></a>Incremental Buffer Design</h4><p><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%206.png" alt="img"></p>
<h4 id="DARMIçš„æ ¸å¿ƒæ“ä½œ"><a href="#DARMIçš„æ ¸å¿ƒæ“ä½œ" class="headerlink" title="DARMIçš„æ ¸å¿ƒæ“ä½œ"></a>DARMIçš„æ ¸å¿ƒæ“ä½œ</h4><p><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%207.png" alt="img"></p>
<p><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%208.png" alt="img"></p>
<p><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%209.png" alt="img"></p>
<p><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%2010.png" alt="img"></p>
<h3 id="ç»“æœï¼š"><a href="#ç»“æœï¼š" class="headerlink" title="ç»“æœï¼š"></a>ç»“æœï¼š</h3><p>æ•°æ®é›†ï¼š<br><br>çœŸå®æ•°æ®é›†ï¼ˆNYCTã€OSMï¼‰ åˆæˆæ•°æ®é›†ï¼ˆLognormalï¼‰<br><br>å·¥ä½œè´Ÿè½½ï¼š<br><br>ï¼ˆ1ï¼‰read-only ï¼ˆ2ï¼‰write-only ï¼ˆ3ï¼‰write-read-balance (50% read 50%write)<br><br>ï¼ˆ4ï¼‰write-heavy(95% write 5% read) ï¼ˆ5ï¼‰read-heavy(95% read 5%write)<br><br>ï¼ˆ6ï¼‰short-ranges(95% range queries 5% write)<br></p>
<p><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%2011.png" alt="img"><br><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%2012.png" alt="img"><br><img src="/../images/EWALI-a-Data-aware-Learned-Index-Schema-for-Efficient-Writes/image%20copy%2013.png" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/09/28/ASLM-Adaptive-Single-Layer-Model-for-Learned-Index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/28/ASLM-Adaptive-Single-Layer-Model-for-Learned-Index/" class="post-title-link" itemprop="url">ASLM:Adaptive Single Layer Model for Learned Index</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-09-28 18:51:06 / Modified: 18:56:14" itemprop="dateCreated datePublished" datetime="2024-09-28T18:51:06-07:00">2024-09-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learned-Index/" itemprop="url" rel="index"><span itemprop="name">Learned Index</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a>åº”ç”¨åœºæ™¯ï¼š</h3><p>è¯»å†™åœºæ™¯</p>
<h3 id="é—®é¢˜æè¿°ï¼š"><a href="#é—®é¢˜æè¿°ï¼š" class="headerlink" title="é—®é¢˜æè¿°ï¼š"></a>é—®é¢˜æè¿°ï¼š</h3><p>Learned Index<br><br>(1)RMI é‡‡ç”¨çš„åˆ†åŒºç­–ç•¥æ²¡æœ‰è€ƒè™‘æ•°æ®ä¹‹é—´çš„ç›¸ä¼¼æ€§<br><br>(2)RMI ä¸æ”¯æŒæ›´æ–°</p>
<p><img src="/../images/ASLM-Adaptive-Single-Layer-Model-for-Learned-Index/1.png" alt="img"></p>
<h3 id="æ–¹æ³•ï¼š"><a href="#æ–¹æ³•ï¼š" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h3><h4 id="åˆ†åŒºç®—æ³•"><a href="#åˆ†åŒºç®—æ³•" class="headerlink" title="åˆ†åŒºç®—æ³•"></a>åˆ†åŒºç®—æ³•</h4><h5 id="Method1"><a href="#Method1" class="headerlink" title="Method1:"></a>Method1:</h5><p><img src="/../images/ASLM-Adaptive-Single-Layer-Model-for-Learned-Index/2.png" alt="img"><br>SLM:è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡å‹ï¼Œåªæœ‰ä¸€å±‚ï¼Œè¿™ä¸€å±‚åŒ…å«Kä¸ªå­æ¨¡å‹</p>
<h5 id="Method2ï¼š"><a href="#Method2ï¼š" class="headerlink" title="Method2ï¼š"></a>Method2ï¼š</h5><p><img src="/../images/ASLM-Adaptive-Single-Layer-Model-for-Learned-Index/3.png" alt="img"><br>æ•°æ®ç‚¹ä¹‹é—´ä¸‰è§’å½¢é¢ç§¯å¯æ›¿æ¢ä¸ºæ¬§å¼è·ç¦»ï¼Œç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªæ•°æ®ç‚¹ä¹‹é—´çš„ç›¸ä¼¼åº¦</p>
<h4 id="æ•°æ®æ’å…¥ï¼š"><a href="#æ•°æ®æ’å…¥ï¼š" class="headerlink" title="æ•°æ®æ’å…¥ï¼š"></a>æ•°æ®æ’å…¥ï¼š</h4><p><img src="/../images/ASLM-Adaptive-Single-Layer-Model-for-Learned-Index/4.png" alt="img"></p>
<p><img src="/../images/ASLM-Adaptive-Single-Layer-Model-for-Learned-Index/5.png" alt="img"></p>
<h3 id="ç»“æœï¼š"><a href="#ç»“æœï¼š" class="headerlink" title="ç»“æœï¼š"></a>ç»“æœï¼š</h3><p><img src="/../images/ASLM-Adaptive-Single-Layer-Model-for-Learned-Index/6.png" alt="img"></p>
<p><img src="/../images/ASLM-Adaptive-Single-Layer-Model-for-Learned-Index/7.png" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/09/28/Dabble-%E5%9F%BA%E4%BA%8E%E4%B8%AD%E9%97%B4%E5%B1%82%E7%9A%84%E5%8F%AF%E6%89%A9%E5%B1%95%E5%AD%A6%E4%B9%A0%E7%B4%A2%E5%BC%95%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/28/Dabble-%E5%9F%BA%E4%BA%8E%E4%B8%AD%E9%97%B4%E5%B1%82%E7%9A%84%E5%8F%AF%E6%89%A9%E5%B1%95%E5%AD%A6%E4%B9%A0%E7%B4%A2%E5%BC%95%E6%8A%80%E6%9C%AF/" class="post-title-link" itemprop="url">Dabble:åŸºäºä¸­é—´å±‚çš„å¯æ‰©å±•å­¦ä¹ ç´¢å¼•æŠ€æœ¯</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-09-28 18:45:43 / Modified: 18:48:28" itemprop="dateCreated datePublished" datetime="2024-09-28T18:45:43-07:00">2024-09-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learned-Index/" itemprop="url" rel="index"><span itemprop="name">Learned Index</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a>åº”ç”¨åœºæ™¯ï¼š</h3><p>è¯»å†™åœºæ™¯</p>
<h3 id="è§£å†³æ–¹æ¡ˆï¼š"><a href="#è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h3><p>æå‡ºDabbleæ¨¡å‹<br><img src="/../images/Dabble-%E5%9F%BA%E4%BA%8E%E4%B8%AD%E9%97%B4%E5%B1%82%E7%9A%84%E5%8F%AF%E6%89%A9%E5%B1%95%E5%AD%A6%E4%B9%A0%E7%B4%A2%E5%BC%95%E6%8A%80%E6%9C%AF/1.png" alt="img"><br>ï¼ˆ1ï¼‰ç”¨K-Meansç®—æ³•æŠŠæ•°æ®é›†è¿›è¡Œèšç±»ï¼Œä»è€Œåˆ’åˆ†ä¸ºKä¸ªæ•°æ®åŒºåŸŸï¼Œä½¿å¾—æ¯ä¸ªåŒºåŸŸå†…çš„æ•°æ®åˆ†å¸ƒå°½å¯èƒ½çš„ä¸€è‡´<br><br>ï¼ˆ2ï¼‰åœ¨æ¨¡å‹è®­ç»ƒé˜¶æ®µï¼Œæˆ‘ä»¬å¯¹Kä¸ªæ•°æ®åŒºåŸŸé‡‡ç”¨å‰é¦ˆç¥ç»ç½‘ç»œè¿›è¡Œå­¦ä¹ ï¼Œå¹¶åœ¨æ¨¡å‹çš„æŸå¤±å‡½æ•°ä¸­åŠ å…¥æ•°æ®çš„è®¿é—®çƒ­åº¦ï¼Œä»è€Œä½¿æ¨¡å‹å¯¹è®¿é—®é¢‘ç‡é«˜çš„æ•°æ®é¢„æµ‹ç‡è¯¥æ›´åŠ ç²¾å‡†<br><br>ï¼ˆ3ï¼‰é’ˆå¯¹æ•°æ®æ’å…¥é—®é¢˜ï¼Œå€Ÿé‰´LSMæ ‘ä¸­çš„å»¶è¿Ÿæ›´æ–°æœºåˆ¶ï¼Œåœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€å—ç¼“å­˜ç”¨æ¥å­˜æ”¾æ–°æ’å…¥çš„æ•°æ®ï¼Œå½“ç¼“å­˜æº¢å‡ºæ—¶ä¸€æ¬¡æ€§å°†æ•°æ®è¿›è¡Œæ’å…¥<br><br>ï¼ˆ4ï¼‰é’ˆå¯¹ç´¢å¼•æ›´æ–°é—®é¢˜ï¼Œæå‡ºäº†ä¸€ç§åŸºäºä¸­é—´å±‚çš„æœºåˆ¶ï¼Œé€šè¿‡æ¨¡å‹è§£è€¦çš„æ–¹å¼ç¼“è§£äº†ç´¢å¼•å¸¦æ¥çš„æ¶ˆè€—</p>
<h3 id="ç»“æœï¼š"><a href="#ç»“æœï¼š" class="headerlink" title="ç»“æœï¼š"></a>ç»“æœï¼š</h3><p>ï¼ˆ1ï¼‰åœ¨ Lognormal äººå·¥æ•°æ®é›†ä¸Š,Dabble æ¨¡å‹çš„æŸ¥è¯¢æ€§èƒ½æ¯” B+æ ‘æå‡äº† 69%,æ¯”å­¦ä¹ ç´¢å¼•æå‡äº† 13%,æ¯” ALEXæå‡äº† 8%;å†…å­˜å ç”¨æ¯” B+æ ‘å‡å°‘äº† 92%,ç¥ç»ç½‘ç»œæ¨¡å‹çš„å†…å­˜å ç”¨æ¯”å­¦ä¹ ç´¢å¼•å‡å°‘äº† 99%,<br>æ¯” ALEX å‡å°‘äº† 98%.åŒæ—¶,Dabble æ¨¡å‹çš„æ’å…¥æ€§èƒ½æ¯” B+æ ‘æå‡äº† 250%,æ¯” ALEX æå‡äº† 123%; <br><br>ï¼ˆ2ï¼‰åœ¨çœŸå®æ•°æ®é›† Weblogs ä¸Š,Dabble çš„æŸ¥è¯¢æ€§èƒ½æ¯” B+æ ‘æå‡äº† 49%,æ¯”å­¦ä¹ ç´¢å¼•æå‡äº† 33%,æ¯” ALEX æå‡äº† 9%;å†…å­˜å ç”¨æ¯” B+æ ‘å‡å°‘äº† 92%,ç¥ç»ç½‘ç»œæ¨¡å‹çš„å†…å­˜å ç”¨æ¯”å­¦ä¹ ç´¢å¼•å‡å°‘äº† 99%,æ¯” ALEX å‡å°‘äº† 98%.åŒæ—¶,Dabble çš„æ’å…¥æ€§èƒ½æ¯” B+æ ‘æå‡äº† 400%,æ¯” ALEX æå‡äº† 88%. </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/08/20/VMware%E7%9A%84%E4%B8%89%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/08/20/VMware%E7%9A%84%E4%B8%89%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">VMwareçš„ä¸‰ç§ç½‘ç»œæ¨¡å¼</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-08-20 18:31:39 / Modified: 18:33:16" itemprop="dateCreated datePublished" datetime="2024-08-20T18:31:39-07:00">2024-08-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">éšç¬”</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://wxler.github.io/2021/02/02/221724/">å‚è€ƒé“¾æ¥</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/05/12/vue3%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/12/vue3%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Tutorial/" class="post-title-link" itemprop="url">vue3å­¦ä¹ â€”â€”Tutorial</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-05-12 21:00:54 / Modified: 23:18:12" itemprop="dateCreated datePublished" datetime="2024-05-12T21:00:54-07:00">2024-05-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vue3/" itemprop="url" rel="index"><span itemprop="name">vue3</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="reactive-å’Œ-ref"><a href="#reactive-å’Œ-ref" class="headerlink" title="reactive() å’Œ ref()"></a>reactive() å’Œ ref()</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;)</span><br><span class="line"><span class="keyword">const</span> message = <span class="title function_">ref</span>(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Count is: &#123;&#123; counter.count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="v-bind"><a href="#v-bind" class="headerlink" title="v-bind"></a>v-bind</h3><p>v-bind:id&#x3D;â€â€<br><br>v-bind:class&#x3D;â€â€<br><br>v-bind:value&#x3D;â€â€<br></p>
<p>ç®€åŒ–ä¸º<br></p>
<p>:id&#x3D;â€â€<br><br>:class&#x3D;â€â€<br><br>:value&#x3D;â€â€<br></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> titleClass = <span class="title function_">ref</span>(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">:class</span>=<span class="string">&quot;titleClass&quot;</span>&gt;</span>Make me red<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.title</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">color</span>: red;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="v-on"><a href="#v-on" class="headerlink" title="v-on"></a>v-on</h3><p>Event Listeners</p>
<p>v-on:click&#x3D;â€â€<br><br>v-on:input&#x3D;â€â€<br></p>
<p>ç®€åŒ–ä¸º<br></p>
<p>@click&#x3D;â€â€<br><br>@input&#x3D;â€â€<br></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">  count.<span class="property">value</span>++</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>Count is: &#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> text = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Type here&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; text &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="v-if-å’Œ-v-else"><a href="#v-if-å’Œ-v-else" class="headerlink" title="v-if å’Œ v-else"></a>v-if å’Œ v-else</h3><p>Conditional Rendering</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> awesome = <span class="title function_">ref</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toggle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  awesome.<span class="property">value</span> = !awesome.<span class="property">value</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;toggle&quot;</span>&gt;</span>Toggle<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-if</span>=<span class="string">&quot;awesome&quot;</span>&gt;</span>Vue is awesome!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-else</span>&gt;</span>Oh no ğŸ˜¢<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h3><p>List Rendering</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// give each todo a unique id</span></span><br><span class="line"><span class="keyword">let</span> id = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newTodo = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> todos = <span class="title function_">ref</span>([</span><br><span class="line">  &#123; <span class="attr">id</span>: id++, <span class="attr">text</span>: <span class="string">&#x27;Learn HTML&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: id++, <span class="attr">text</span>: <span class="string">&#x27;Learn JavaScript&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: id++, <span class="attr">text</span>: <span class="string">&#x27;Learn Vue&#x27;</span> &#125;</span><br><span class="line">])</span><br><span class="line"><span class="comment">// const index = ref(&quot;123&quot;)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  todos.<span class="property">value</span>.<span class="title function_">push</span>(&#123;<span class="attr">id</span>: id++, <span class="attr">text</span>: newTodo.<span class="property">value</span>&#125;);</span><br><span class="line">  newTodo.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeTodo</span>(<span class="params">todo</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// index.value</span></span><br><span class="line">  todos.<span class="property">value</span>.<span class="title function_">splice</span>(todos.<span class="property">value</span>.<span class="title function_">indexOf</span>(todo), <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">form</span> @<span class="attr">submit.prevent</span>=<span class="string">&quot;addTodo&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;newTodo&quot;</span> <span class="attr">required</span> <span class="attr">placeholder</span>=<span class="string">&quot;new todo&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>Add Todo<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!--   &lt;p&gt;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    &#123;&#123;index&#125;&#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">  &lt;/p&gt; --&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in todos&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;todo.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;&#123; todo.text &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;removeTodo(todo)&quot;</span>&gt;</span>X<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>


<h3 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h3><blockquote>
<p>introducing computed().We can create a computed ref that computes its .value based on other reactive data sources:</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> id = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newTodo = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> hideCompleted = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> todos = <span class="title function_">ref</span>([</span><br><span class="line">  &#123; <span class="attr">id</span>: id++, <span class="attr">text</span>: <span class="string">&#x27;Learn HTML&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: id++, <span class="attr">text</span>: <span class="string">&#x27;Learn JavaScript&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: id++, <span class="attr">text</span>: <span class="string">&#x27;Learn Vue&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> filteredTodos = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> hideCompleted.<span class="property">value</span></span><br><span class="line">    ? todos.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> !t.<span class="property">done</span>)</span><br><span class="line">    : todos.<span class="property">value</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  todos.<span class="property">value</span>.<span class="title function_">push</span>(&#123; <span class="attr">id</span>: id++, <span class="attr">text</span>: newTodo.<span class="property">value</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">  newTodo.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeTodo</span>(<span class="params">todo</span>) &#123;</span><br><span class="line">  todos.<span class="property">value</span> = todos.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> t !== todo)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;</span><br><span class="line">    &lt;input v-model=&quot;newTodo&quot; required placeholder=&quot;new todo&quot;&gt;</span><br><span class="line">    &lt;button&gt;Add Todo&lt;/button&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li v-for=&quot;todo in filteredTodos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;checkbox&quot; v-model=&quot;todo.done&quot;&gt;</span><br><span class="line">      &lt;span :class=&quot;&#123; done: todo.done &#125;&quot;&gt;&#123;&#123; todo.text &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">  &lt;button @click=&quot;hideCompleted = !hideCompleted&quot;&gt;</span><br><span class="line">    &#123;&#123; hideCompleted ? &#x27;Show all&#x27; : &#x27;Hide completed&#x27; &#125;&#125;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.done &#123;</span><br><span class="line">  text-decoration: line-through;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Lifecycle-and-Template-Refs"><a href="#Lifecycle-and-Template-Refs" class="headerlink" title="Lifecycle and Template Refs"></a>Lifecycle and Template Refs</h3><blockquote>
<p>Hookå‡½æ•° onMounted onUpdated ç­‰ â€¦</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pElementRef = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> customValue = <span class="title function_">ref</span>(<span class="string">&quot;123&quot;</span>)</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  customValue.<span class="property">value</span> = pElementRef.<span class="property">value</span>.<span class="property">textContent</span></span><br><span class="line">  pElementRef.<span class="property">value</span>.<span class="property">textContent</span> = <span class="string">&#x27;mounted!&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span> &#123;&#123;customValue&#125;&#125; <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">ref</span>=<span class="string">&quot;pElementRef&quot;</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(count, <span class="function">(<span class="params">newCount</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// yes, console.log() is a side effect</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`new count is: <span class="subst">$&#123;newCount&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>watch() can directly watch a ref, and the callback gets fired whenever countâ€™s value changes.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todoId = <span class="title function_">ref</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> todoData = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  todoData.<span class="property">value</span> = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(</span><br><span class="line">    <span class="string">`https://jsonplaceholder.typicode.com/todos/<span class="subst">$&#123;id.value&#125;</span>`</span></span><br><span class="line">  )</span><br><span class="line">  todoData.<span class="property">value</span> = <span class="keyword">await</span> res.<span class="title function_">json</span>()</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="title function_">fetchData</span>(todoId)</span><br><span class="line"><span class="title function_">watch</span>(todoId, <span class="function">(<span class="params">todoId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fetchData</span>(todoId);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Todo id: &#123;&#123; todoId &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;todoId++&quot;</span> <span class="attr">:disabled</span>=<span class="string">&quot;!todoData&quot;</span>&gt;</span>Fetch next todo<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;!todoData&quot;</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">pre</span> <span class="attr">v-else</span>&gt;</span>&#123;&#123; todoData &#125;&#125;<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComp</span> <span class="keyword">from</span> <span class="string">&#x27;./ChildComp.vue&#x27;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!-- render child component --&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">ChildComp</span>&gt;</span><span class="tag">&lt;/<span class="name">ChildComp</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h3><blockquote>
<p>A child component can accept input from the parent via props. First, it needs to declare the props it accepts:</p>
</blockquote>
<p>App.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComp</span> <span class="keyword">from</span> <span class="string">&#x27;./ChildComp.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> greeting = <span class="title function_">ref</span>(<span class="string">&#x27;Hello from parent&#x27;</span>)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">ChildComp</span> <span class="attr">:msg</span>=<span class="string">&quot;greeting&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>ChildComp.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">msg</span>: <span class="title class_">String</span></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; msg || &#x27;No props passed yet&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="Emits"><a href="#Emits" class="headerlink" title="Emits"></a>Emits</h3><blockquote>
<p>In addition to receiving props, a child component can also emit events to the parent:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import ChildComp from &#x27;./ChildComp.vue&#x27;</span><br><span class="line"></span><br><span class="line">const childMsg = ref(&#x27;No child msg yet&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ChildComp @response=&quot;(msg) =&gt; childMsg = msg &quot; @response1=&quot;(msg)=&gt; childMsg=msg&quot;/&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; childMsg &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">const emit = defineEmits([&#x27;response&#x27;, &#x27;response1&#x27;])</span><br><span class="line"></span><br><span class="line">emit(&#x27;response&#x27;, &#x27;hello from child&#x27;)</span><br><span class="line">emit(&#x27;response1&#x27;, &quot;flafkjka&quot;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;Child component&lt;/h2&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Slots"><a href="#Slots" class="headerlink" title="Slots"></a>Slots</h3><blockquote>
<p>In addition to passing data via props, the parent component can also pass down template fragments to the child via slots</p>
</blockquote>
<p>App.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComp</span> <span class="keyword">from</span> <span class="string">&#x27;./ChildComp.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> msg = <span class="title function_">ref</span>(<span class="string">&#x27;from parent&#x27;</span>)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">ChildComp</span>&gt;</span><span class="tag">&lt;/<span class="name">ChildComp</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>ChildComp.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">slot</span>&gt;</span>Fallback content<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/05/11/javascript%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/11/javascript%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">javascriptåŸºç¡€è¯­æ³•</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-05-11 05:44:34 / Modified: 20:47:39" itemprop="dateCreated datePublished" datetime="2024-05-11T05:44:34-07:00">2024-05-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p><strong>å€¼ç±»å‹(åŸºæœ¬ç±»å‹)</strong>  ï¼šå­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€æ•°å­—(Number)ã€å¸ƒå°”(Boolean)ã€ç©ºï¼ˆnullï¼‰ã€æœªå®šä¹‰ï¼ˆUndefinedï¼‰ã€Symbolã€‚</p>
<blockquote>
<p>æ‰€æœ‰çš„å€¼ç±»å‹(åŸºæœ¬ç±»å‹), é™¤äº†nullå’Œundefined, éƒ½å¯ä»¥è¢«çœ‹åšå¯¹è±¡</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">123</span>)</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>jsä¸­ä¸€åˆ‡çš†å¯¹è±¡</p>
</blockquote>
<p><strong>å¼•ç”¨æ•°æ®ç±»å‹(å¯¹è±¡ç±»å‹)</strong> ï¼š å¯¹è±¡(Object)ã€æ•°ç»„(Array)ã€å‡½æ•°(Function)ã€æ­£åˆ™ï¼ˆRegExpï¼‰å’Œæ—¥æœŸï¼ˆDateï¼‰</p>
<p><img src="/../images/javascript%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/1.png" alt="img"></p>
<blockquote>
<p>ps: å®šä¹‰å˜é‡å¾—ä½¿ç”¨ var æˆ–è€… let<br>å¯ä»¥ç”¨typeof æ¥æŸ¥çœ‹å˜é‡çš„ç±»å‹</p>
</blockquote>
<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myFunction</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h3><p>classå…³é”®å­—æ˜¯åŸå‹ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªè¯­æ³•ç³–ï¼Œåˆ›é€ äº†ä¸€ç§åŸºäºç±»çš„è¯­è¨€çš„é”™è§‰ã€‚</p>
<p><strong>proto</strong>, prototype, constructorçš„å…³ç³»</p>
<p><img src="/../images/javascript%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/3.png" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/04/02/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/02/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/" class="post-title-link" itemprop="url">DILIè®ºæ–‡é‡ç‚¹éƒ¨åˆ†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-04-02 05:08:10" itemprop="dateCreated datePublished" datetime="2024-04-02T05:08:10-07:00">2024-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-12 20:46:32" itemprop="dateModified" datetime="2024-04-12T20:46:32-07:00">2024-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learned-Index/" itemprop="url" rel="index"><span itemprop="name">Learned Index</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="DILIï¼šA-Distribution-driven-Learned-Index"><a href="#DILIï¼šA-Distribution-driven-Learned-Index" class="headerlink" title="DILIï¼šA Distribution-driven Learned Index"></a>DILIï¼šA Distribution-driven Learned Index</h2><p>æ‘˜è¦ï¼š<br><br>DILIçš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆinternal node å’Œ leaf nodeï¼‰éƒ½æœ‰ä¸€ä¸ªLinear modelï¼Œå¹¶ä¸”internal nodeçš„keyâ€™s rangeè¢«å®ƒçš„child nodeå‡åˆ†ï¼Œå½“è¿›è¡ŒkeyæŸ¥æ‰¾æ—¶ï¼Œå¯ä»¥å‡†ç¡®åœ°æ‰¾åˆ°å¯¹åº”çš„leaf nodeã€‚åœ¨leaf nodeä¸­çš„linear modelæ˜¯å¯ä»¥å‡†ç¡®é¢„æµ‹keyçš„ä½ç½®çš„ã€‚</p>
<p>ä¸ºäº†æ„å»ºDILIï¼Œé¦–å…ˆæ„å»ºä¸€é¢—bottom-up tree,ç„¶åä½¿ç”¨è¿™ä¸ªbottom-up treeï¼Œè‡ªé¡¶å‘ä¸‹æ„å»ºä¸€ä¸ªDILIæ ‘ã€‚DILIåœ¨the number of leaf nodeså’Œtree heightä¹‹é—´æœ‰ä¸€ä¸ªå¾ˆå¥½çš„å¹³è¡¡ï¼ˆthe number of leaf nodes å’Œ tree heightæ˜¯å½±å“keyæœç´¢æ—¶é—´çš„å…³é”®å› ç´ ï¼‰ã€‚è®¾è®¡äº†çµæ´»çš„æ’å…¥å’Œåˆ é™¤ç®—æ³•ï¼Œå¹¶åœ¨å¿…è¦æ—¶è°ƒæ•´æ ‘å½¢ç»“æ„ã€‚</p>
<p>å®éªŒç»“æœè¡¨æ˜DILIæ¯”å…¶å®ƒbaselineåœ¨ä¸åŒçš„workloadsä¸Šè¦è¡¨ç°çš„æ›´å¥½ã€‚</p>
<h3 id="1-INTRODUCTION"><a href="#1-INTRODUCTION" class="headerlink" title="1.INTRODUCTION"></a>1.INTRODUCTION<br></h3><p>RMIï¼šä»…æ”¯æŒæŸ¥æ‰¾<br><br>ALEXï¼šæ‰©å±•RMIï¼Œåœ¨leaf nodeä¸­ä½¿ç”¨ gapped arrayï¼Œä½¿ç”¨ cost modelåˆå§‹åŒ–RMIç»“æ„å’ŒåŠ¨æ€æ›´æ–°RMIç»“æ„ã€‚å­˜åœ¨last-mileé—®é¢˜<br><br>LIPPï¼šè§£å†³last-mileé—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰åˆ©ç”¨data distribution<br><br>DILI-LOï¼šæœªè§£å†³last-mileé—®é¢˜ï¼Œåˆ©ç”¨data distribution<br><br>DILIï¼šè§£å†³last-mileé—®é¢˜ï¼Œåˆ©ç”¨data distribution<br></p>
<p>æ„å»ºDILIçš„ç›®çš„æ˜¯å®ç°æœ€å¥½çš„æœç´¢æ€§èƒ½ â€”&gt; æœç´¢çš„å¼€é”€å–å†³äº(1)leaf nodeçš„æ·±åº¦(2)leaf  nodeä¸­çš„linear modelé¢„æµ‹çš„accuracy â€”&gt; è¿™ä¸¤ä¸ªfactorséƒ½åº”è¯¥åœ¨DILIçš„æ„å»ºä¸­è¢«è€ƒè™‘</p>
<p>å› æ­¤ï¼Œæå‡ºäº†ä¸€ä¸ªtwo-phase bulk loading æ–¹æ³•<br><br><strong>Phase1</strong> -&gt; ä½¿ç”¨greedy merging algorithmï¼ˆè€ƒè™‘åˆ°äº†ä¸Šé¢çš„ä¸¤ä¸ªfactorsï¼‰ æ„å»ºä¸€æ£µBU-treeï¼ˆBU-treeçš„internal nodeâ€™srangeå¹¶ä¸æ˜¯è¢«å®ƒçš„child nodeså‡åˆ†çš„ï¼Œå› æ­¤åœ¨BU-treeè¿›è¡Œkeyæœç´¢æ—¶ï¼Œç¡®å®šchild nodeéœ€è¦é¢å¤–çš„å¼€é”€ï¼‰</p>
<p><strong>Phase2</strong> -&gt;  å€Ÿé‰´BU-treeçš„ç»“æ„æ„å»ºDILI</p>
<h4 id="Contribution"><a href="#Contribution" class="headerlink" title="Contribution"></a>Contribution</h4><ul>
<li>æå‡ºDILIï¼Œalgorithms å’Œå®ƒçš„cost analysis</li>
<li>æ„å»ºDILIçš„two-phase bulk loading æ–¹æ³•</li>
<li>å¯¹DILIçš„leaf nodeçš„local optimizationï¼Œè§£å†³last-mileé—®é¢˜</li>
<li>å¯¹äºDILIçš„insertionå’Œdeletionæ“ä½œæå‡ºç›¸åº”çš„algorithmæ¥ç»´æŒæŸ¥æ‰¾æ€§èƒ½</li>
<li>åœ¨synthetic dataå’Œreal dataä¸Šè¯å®DILIçš„æ€§èƒ½</li>
</ul>
<h3 id="2-OVERVIEW-OF-DILI"><a href="#2-OVERVIEW-OF-DILI" class="headerlink" title="2.OVERVIEW OF DILI"></a>2.OVERVIEW OF DILI</h3><p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/1.png" alt="img"><br>DILIçš„ç»“æ„å¦‚Figure 1æ‰€ç¤º<br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/2.png" alt="img"><br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/3.png" alt="img"><br>DILIåœ¨æ²¡æœ‰ä½¿ç”¨local Optimizationçš„æ—¶å€™SEARCHç®—æ³•å¦‚ä¸‹ï¼ŒæŸ¥æ‰¾keyæ—¶ï¼Œé”å®šäº†leaf nodeåéœ€è¦å†è¿›è¡ŒæŒ‡æ•°æŸ¥æ‰¾æ¥ç¡®å®špositionã€‚<br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/4.png" alt="img"></p>
<h4 id="Local-Optimization-strategy"><a href="#Local-Optimization-strategy" class="headerlink" title="Local Optimization strategy"></a>Local Optimization strategy</h4><p>åœ¨leaf nodeä¸­ï¼Œå…ˆç”¨çº¿æ€§æ¨¡å‹é¢„æµ‹keyçš„positionï¼Œä¹‹åç›´æ¥å°†keyæ”¾åˆ°é¢„æµ‹çš„positionä¸Šï¼Œå¦‚æœå‘ç”Ÿå†²çªï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„nodeï¼Œå¯¹åº”çš„entryè®¾ç½®ä¸ºæŒ‡å‘æ–°nodeçš„æŒ‡é’ˆ</p>
<h4 id="Updates"><a href="#Updates" class="headerlink" title="Updates"></a>Updates</h4><p>å½“å¯¹DILIæ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå‘ç”Ÿconflictï¼Œä¼šåˆ›å»ºæ–°çš„Nodeï¼Œå½“åˆ›å»ºçš„æ–°Nodeè¿‡å¤šå¹¶ä¸”é€€åŒ–äº†æŸ¥æ‰¾æ€§èƒ½æ—¶ï¼Œéœ€è¦è¿›è¡Œè°ƒæ•´ç­–ç•¥ï¼ˆåœ¨section6ä¼šè¯¦ç»†æè¿°ï¼‰</p>
<h3 id="3-SEARCH-COST-ANALYSIS"><a href="#3-SEARCH-COST-ANALYSIS" class="headerlink" title="3.SEARCH COST ANALYSIS"></a>3.SEARCH COST ANALYSIS</h3><p>Cost Analysis:<br>æœªä½¿ç”¨local optimization strategy<br>Algorithm1ç”±ä¸¤æ­¥ç»„æˆ(1)æ‰¾åˆ°åŒ…å«search keyçš„leaf node (2)leaf nodeä¸­çš„local search<br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/5.png" alt="img"></p>
<h3 id="4-CONSTRUCTION-OF-DILI"><a href="#4-CONSTRUCTION-OF-DILI" class="headerlink" title="4.CONSTRUCTION OF DILI"></a>4.CONSTRUCTION OF DILI</h3><h4 id="4-1Motivation-and-Overall-Idea-of-BU-Tree"><a href="#4-1Motivation-and-Overall-Idea-of-BU-Tree" class="headerlink" title="4.1Motivation and Overall Idea of BU-Tree"></a>4.1Motivation and Overall Idea of BU-Tree</h4><p>DILIçš„internal nodeçš„çº¿æ€§æ¨¡å‹æœ‰ç€å®Œç¾çš„å‡†ç¡®æ€§ï¼Œå› ä¸ºinternal nodeè¢«å®ƒçš„child nodeså‡åˆ†ã€‚â€”-&gt; ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ç¡®å®šDILIçš„fanout</p>
<p>å¤§è‡´æ€è·¯ï¼š<br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/6.png" alt="img"><br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/7.png" alt="img"></p>
<h4 id="4-2-Building-BU-Tree"><a href="#4-2-Building-BU-Tree" class="headerlink" title="4.2 Building BU-Tree"></a>4.2 Building BU-Tree</h4><p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/8.png" alt="img"></p>
<h5 id="4-2-1-Bottom-up-Node-and-Model-Creation"><a href="#4-2-1-Bottom-up-Node-and-Model-Creation" class="headerlink" title="4.2.1 Bottom-up Node and Model Creation"></a>4.2.1 Bottom-up Node and Model Creation</h5><p>æ„å»ºç¬¬0å±‚çš„leaf node<br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/9.png" alt="img"><br>å·²çŸ¥h - 1å±‚çš„internal node,æ„å»ºç¬¬hå±‚çš„internal node<br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/10.png" alt="img"></p>
<h5 id="4-2-2-Determining-Node-Layout-at-A-Height"><a href="#4-2-2-Determining-Node-Layout-at-A-Height" class="headerlink" title="4.2.2 Determining Node Layout at A Height"></a>4.2.2 Determining Node Layout at A Height</h5><p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/11.png" alt="img"><br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/12.png" alt="img"></p>
<p>ä½†æ˜¯BU-Treeæ˜¯ä»ä¸‹å¾€ä¸Šåˆ›å»ºçš„ï¼Œå³ä½¿åˆ›å»ºäº†ç¬¬hå±‚çš„nodeï¼Œæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“BU-Treeçš„é«˜åº¦</p>
<p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/13.png" alt="img"><br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/14.png" alt="img"></p>
<h4 id="4-3-BU-Tree-based-Bulk-loading-for-DILI"><a href="#4-3-BU-Tree-based-Bulk-loading-for-DILI" class="headerlink" title="4.3 BU-Tree based Bulk loading for DILI"></a>4.3 BU-Tree based Bulk loading for DILI</h4><p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/15.png" alt="img"></p>
<h4 id="4-4-Remarks"><a href="#4-4-Remarks" class="headerlink" title="4.4 Remarks"></a>4.4 Remarks</h4><p>Skip â€¦â€¦</p>
<h3 id="5-LOCAL-OPTIMIZATION-OF-DILI"><a href="#5-LOCAL-OPTIMIZATION-OF-DILI" class="headerlink" title="5. LOCAL OPTIMIZATION OF DILI"></a>5. LOCAL OPTIMIZATION OF DILI</h3><p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/16.png" alt="img"><br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/17.png" alt="img"><br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/18.png" alt="img"></p>
<h3 id="6-DATA-UPDATES-IN-DILI"><a href="#6-DATA-UPDATES-IN-DILI" class="headerlink" title="6. DATA UPDATES IN DILI"></a>6. DATA UPDATES IN DILI</h3><h4 id="6-1-Insertions"><a href="#6-1-Insertions" class="headerlink" title="6.1 Insertions"></a>6.1 Insertions</h4><p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/19.png" alt="img"><br>P existsæ ‡æ³¨çš„åœ°æ–¹é”™è¯¯		åº”è®¾ç½®ä¸ºnotExist  &lt;â€”  False</p>
<h4 id="6-2-Deletions"><a href="#6-2-Deletions" class="headerlink" title="6.2 Deletions"></a>6.2 Deletions</h4><p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/20.png" alt="img"></p>
<h3 id="7-EXPERIMENTAL-STUDIES"><a href="#7-EXPERIMENTAL-STUDIES" class="headerlink" title="7.EXPERIMENTAL STUDIES"></a>7.EXPERIMENTAL STUDIES</h3><h4 id="7-1-Experimental-Settings"><a href="#7-1-Experimental-Settings" class="headerlink" title="7.1 Experimental Settings"></a>7.1 Experimental Settings</h4><p>æ•°æ®é›†ï¼šä½¿ç”¨äº†SOSD benchmarkä¸­çš„4ä¸ªçœŸå®æ•°æ®é›† å’Œ 1 ä¸ªåˆæˆæ•°æ®é›†</p>
<ul>
<li>FB : 200M Facebook ç”¨æˆ·id</li>
<li>WikiTS : 200M ç»´åŸºç™¾ç§‘ç½‘ç«™æ—¥å¿—æ¡ç›®çš„å”¯ä¸€è¯·æ±‚æ—¶é—´æˆ³</li>
<li>OSM :  800M OpenStreetMapå•å…ƒæ ¼çš„id</li>
<li>Books : 800M Amazonçš„booksçš„id</li>
<li>Logn : 200M ä»é‡å°¾é‡‡æ ·çš„ç‹¬ç‰¹å€¼ N(0ï¼Œ 1) çš„å¯¹æ•°æ­£æ€åˆ†å¸ƒ</li>
</ul>
<p>æ¯”è¾ƒçš„baselines:<br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/21.png" alt="img"></p>
<p>Table 2 æ€»ç»“äº†æ‰€æœ‰indexçš„å±æ€§ç‰¹ç‚¹ï¼Œæ›´å¥½çš„è¡¨ç°è¢«åŠ ç²—äº†<br><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/22.png" alt="img"></p>
<p>Evaluation Metrics : <br><br>Lookup â€”&gt; å¹³å‡æ¯æ¬¡queryæ‰€ç”¨çš„æ—¶é—´ <br><br>Throughtput â€”&gt; å¹³å‡æ¯secondæ‰§è¡Œçš„operationsçš„æ¬¡æ•°ï¼ˆqueryã€insertionã€deletionï¼‰<br></p>
<h4 id="7-2-Overall-Query-Performance"><a href="#7-2-Overall-Query-Performance" class="headerlink" title="7.2 Overall Query Performance"></a>7.2 Overall Query Performance</h4><p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/23.png" alt="img"></p>
<p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/24.png" alt="img"></p>
<h4 id="7-3-Performance-on-Different-Workloads"><a href="#7-3-Performance-on-Different-Workloads" class="headerlink" title="7.3 Performance on Different Workloads"></a>7.3 Performance on Different Workloads</h4><p>(1)The Read-only workload: 100M point queries <br><br>(2)The Read-Heavy workload: 50M insertions and 100M point queries <br><br>(3)The Write-Heavy workload: 100M insertions and 50M point queries <br><br>(4)The Write-only workload: 100M insertions <br></p>
<p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/25.png" alt="img"></p>
<h4 id="7-4-Effect-of-Many-Deletions"><a href="#7-4-Effect-of-Many-Deletions" class="headerlink" title="7.4 Effect of Many Deletions"></a>7.4 Effect of Many Deletions</h4><p>(1)Read-Heavy workload : 100M lookups and 50M deletions<br>DILI achieves up to 3.6X, 2.3X, 7.0X and 2.3X higher throughput than B+ Tree,PGM,MassTree and ALEX,respectively.</p>
<p>(2)Deletion-Heavy workload : 100M deletions and 50M lookups<br>Only ALEX performs a little better than DILI on Logn dataset</p>
<p><img src="/../images/DILI%E8%AE%BA%E6%96%87%E9%87%8D%E7%82%B9%E9%83%A8%E5%88%86/26.png" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/03/16/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/16/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" class="post-title-link" itemprop="url">å¸ƒéš†è¿‡æ»¤å™¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-16 02:55:19" itemprop="dateCreated datePublished" datetime="2024-03-16T02:55:19-07:00">2024-03-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-02 05:03:05" itemprop="dateModified" datetime="2024-04-02T05:03:05-07:00">2024-04-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">å¸ƒéš†è¿‡æ»¤å™¨</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>æŸ¥æ‰¾æ—¶ï¼Œè¿‡æ»¤æ‰ä¸€å®šä¸å­˜åœ¨çš„keyï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡</p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>åœ¨æ•°ç»„æˆ–è€…åˆ—è¡¨ä¸­æœç´¢ç›¸åº”å€¼çš„æ—¶å€™ï¼Œä½ å¿…é¡»éå†å·²æœ‰çš„é›†åˆã€‚è‹¥é›†åˆä¸­å­˜åœ¨å¤§é‡çš„æ•°æ®ï¼Œå°±ä¼šå½±å“æŸ¥æ‰¾çš„æ•ˆç‡</p>
<p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œåˆ©ç”¨å“ˆå¸Œè¡¨æ¥å¯¹â€å€¼â€è¿›è¡Œå“ˆå¸Œå¤„ç†æ¥è·å¾—è¯¥å€¼å¯¹åº”çš„ç´¢å¼•å€¼ï¼Œç„¶åå°†è¯¥â€å€¼â€å­˜æ”¾åˆ°åˆ—è¡¨ä¸­å¯¹åº”çš„ç´¢å¼•ä½ç½®ã€‚<br>è¿™æ„å‘³ç€åˆ¤æ–­åˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¯¥å€¼æ—¶ï¼Œåªéœ€è¦å¯¹å€¼è¿›è¡Œå“ˆå¸Œå¤„ç†å¹¶åœ¨ç›¸åº”çš„ç´¢å¼•ä½ç½®è¿›è¡Œæœç´¢å³å¯ï¼Œè¿™æ—¶çš„æœç´¢é€Ÿåº¦æ˜¯éå¸¸å¿«çš„ã€‚</p>
<p><img src="/../images/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/1.png" alt="img"></p>
<p>Bloom Filteræœ¬è´¨ä¸Šæ˜¯ç”±é•¿åº¦ä¸ºmçš„ä½å‘é‡ï¼ˆä»…åŒ…å«0æˆ–è€…1ï¼‰ç»„æˆï¼Œæœ€åˆæ‰€æœ‰å€¼å‡è®¾ç½®ä¸º0ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/../images/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/2.png" alt="img"></p>
<p>ä¸ºäº†å°†æ•°æ®é¡¹æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œä½¿ç”¨kä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°å¯¹å…¶è¿›è¡Œå“ˆå¸Œï¼Œå¹¶å°†ç»“æœä½ç½®ä¸Šå¯¹åº”ä½ç½®ä¸º1</p>
<h3 id="ç®€å•çš„ä¾‹å­"><a href="#ç®€å•çš„ä¾‹å­" class="headerlink" title="ç®€å•çš„ä¾‹å­"></a>ç®€å•çš„ä¾‹å­</h3><p>è¾“å…¥â€semlinkerâ€ï¼Œé¢„è®¾çš„3ä¸ªå“ˆå¸Œå‡½æ•°å°†è¾“å‡º2ã€4ã€6,æˆ‘ä»¬æŠŠç›¸åº”ä½ç½®ä¸º1<br><img src="/../images/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/3.png" alt="img"><br>å†è¾“å…¥â€kakuqoâ€ï¼Œå“ˆå¸Œå‡½æ•°è¾“å‡º3ã€4ã€7,æŠŠå¯¹åº”ä½ç½®ä¸º1<br><img src="/../images/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/4.png" alt="img"><br>å†è¾“å…¥â€fullstackâ€,å“ˆå¸Œå‡½æ•°è¾“å‡º2ã€3ã€7ï¼Œè¿™æ—¶å‘ç°ç›¸åº”çš„ç´¢å¼•ä½éƒ½å·²ç»ç½®ä¸ºäº†1ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¯´â€fullstackâ€å¯èƒ½å·²ç»æ’å…¥åˆ°é›†åˆä¸­ã€‚è¿™æ˜¯ä¸€ç§è¯¯åˆ¤æƒ…å†µ<br><img src="/../images/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/5.png" alt="img"></p>
<p>å¸ƒéš†è¿‡æ»¤å™¨æœ‰ä¸€ä¸ªå¯é¢„æµ‹çš„è¯¯åˆ¤ç‡(FPP):<br><img src="/../images/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/6.png" alt="img"></p>
<ul>
<li>næ˜¯å·²ç»æ·»åŠ å…ƒç´ çš„æ•°é‡</li>
<li>kæ˜¯å“ˆå¸Œçš„æ¬¡æ•°</li>
<li>mä¸ºå¸ƒéš†è¿‡æ»¤å™¨çš„é•¿åº¦(å¦‚æ¯”ç‰¹æ•°ç»„çš„å¤§å°)</li>
</ul>
<p>å®é™…æƒ…å†µä¸­ï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„é•¿åº¦må¯ä»¥æ ¹æ®è¯¯åˆ¤ç‡(FFP)çš„å’ŒæœŸæœ›æ·»åŠ çš„å…ƒç´ ä¸ªæ•°nçš„é€šè¿‡å¦‚ä¸‹å…¬å¼è®¡ç®—:<br><img src="/../images/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/7.png" alt="img"></p>
<blockquote>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œå½“æˆ‘ä»¬æœç´¢ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œè‹¥è¯¥å€¼ç»è¿‡kä¸ªå“ˆå¸Œå‡½æ•°è¿ç®—åä»»ä½•ä¸€ä¸ªç´¢å¼•ä½ä¸º0ï¼Œé‚£ä¹ˆè¯¥å€¼è‚¯å®šä¸åœ¨é›†åˆä¸­ã€‚ä½†å¦‚æœæ‰€æœ‰å“ˆå¸Œç´¢å¼•å€¼å‡ä¸º1ï¼Œåˆ™åªèƒ½è¯´è¯¥æœç´¢çš„å€¼å¯èƒ½å­˜åœ¨é›†åˆä¸­</p>
</blockquote>
<h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œå¸ƒéš†è¿‡æ»¤å™¨å¸¸è§çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç½‘é¡µçˆ¬è™«å¯¹ URL å»é‡ï¼Œé¿å…çˆ¬å–ç›¸åŒçš„ URL åœ°å€ï¼›</li>
<li>ååƒåœ¾é‚®ä»¶ï¼Œä»æ•°åäº¿ä¸ªåƒåœ¾é‚®ä»¶åˆ—è¡¨ä¸­åˆ¤æ–­æŸé‚®ç®±æ˜¯å¦åƒåœ¾é‚®ç®±ï¼›</li>
<li>Google Chrome ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¯†åˆ«æ¶æ„ URLï¼›</li>
<li>Medium ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨é¿å…æ¨èç»™ç”¨æˆ·å·²ç»è¯»è¿‡çš„æ–‡ç« ï¼›</li>
<li>Google BigTableï¼ŒApache HBbase å’Œ Apache Cassandra ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å‡å°‘å¯¹ä¸å­˜åœ¨çš„è¡Œå’Œåˆ—çš„æŸ¥æ‰¾</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/03/04/GRE%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/04/GRE%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/" class="post-title-link" itemprop="url">GREä½¿ç”¨æ‰‹å†Œ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-03-04 06:02:31 / Modified: 07:12:51" itemprop="dateCreated datePublished" datetime="2024-03-04T06:02:31-08:00">2024-03-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learned-Index/" itemprop="url" rel="index"><span itemprop="name">Learned Index</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä¸‹è½½å®˜ç½‘åœ°å€"><a href="#ä¸‹è½½å®˜ç½‘åœ°å€" class="headerlink" title="ä¸‹è½½å®˜ç½‘åœ°å€:"></a>ä¸‹è½½å®˜ç½‘åœ°å€:<br></h2><p><a target="_blank" rel="noopener" href="https://github.com/jingtao8a/GRE">https://github.com/jingtao8a/GRE</a></p>
<h2 id="è½¯ä»¶ç¯å¢ƒ"><a href="#è½¯ä»¶ç¯å¢ƒ" class="headerlink" title="è½¯ä»¶ç¯å¢ƒ"></a>è½¯ä»¶ç¯å¢ƒ</h2><p>Ubuntu 20.04.6 LTS<br><br>gcc 9.4.0<br><br>cmake 3.16.3</p>
<h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><h3 id="intel-mkl-2018-4-274"><a href="#intel-mkl-2018-4-274" class="headerlink" title="intel-mkl 2018.4.274"></a>intel-mkl 2018.4.274<br></h3><p>è¿™é‡Œå®‰è£…2024çš„ç‰ˆæœ¬ä¹Ÿå¯ä»¥<br><br>è¿›å…¥å®˜ç½‘ <a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl-download.html">https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl-download.html</a><br></p>
<p>é€‰æ‹©Linux å’Œ APT Package Manager<br><img src="/../images/GRE%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/3.png" alt="img"><br>ä¾æ¬¡è¾“å…¥å‘½ä»¤<br><img src="/../images/GRE%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/1.png" alt="img"><br><img src="/../images/GRE%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/2.png" alt="img"></p>
<p>é»˜è®¤å®‰è£…è·¯å¾„å¦‚ä¸‹ï¼š<br><img src="/../images/GRE%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/4.png" alt="img"></p>
<p>ä½¿ç”¨mklåº“éœ€è¦é…ç½®ç¯å¢ƒå˜é‡ï¼š<br></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œéœ€è¦é‡å¯ç³»ç»Ÿ</span><br><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure>
<p><img src="/../images/GRE%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/5.png" alt="img"></p>
<h3 id="intel-tbb-2020-3"><a href="#intel-tbb-2020-3" class="headerlink" title="intel-tbb 2020.3"></a>intel-tbb 2020.3<br></h3><p>tbbåº“çš„ç‰ˆæœ¬å¿…é¡»ä½¿ç”¨2020.3<br><br>ä¸‹è½½åœ°å€<a target="_blank" rel="noopener" href="https://github.com/oneapi-src/oneTBB/releases/tag/2020_U3">https://github.com/oneapi-src/oneTBB/releases/tag/2020_U3</a></p>
<h4 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å‹</span></span><br><span class="line">tar -zxvf oneTBB-2020_U3.tar.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å› ä¸ºè¦ä½¿ç”¨ gcc-9 è¿›è¡Œç¼–è¯‘ï¼Œæ‰€ä»¥éœ€è¦ç¼–è¾‘æˆ gcc-9 å½¢å¼</span></span><br><span class="line">cp build/linux.gcc.inc build/linux.gcc-9.inc </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¾‘ linux.gcc-9.inc æ–‡ä»¶ï¼š</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¬¬15ã€16è¡ŒåŸæ¥æ˜¯</span></span><br><span class="line">CPLUS ?= g++</span><br><span class="line">CONLY ?= gcc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ä¸º</span></span><br><span class="line">CPLUS ?= g++-9</span><br><span class="line">CONLY ?= gcc-9</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç„¶ååœ¨æ–‡ä»¶å¤¹ oneTBB-2020_U3/ ä¸­ç¼–è¯‘</span></span><br><span class="line">cd oneTBB-2020_U3</span><br><span class="line">make compiler=gcc-9 stdver=c++17 tbb_build_prefix=my_tbb_build</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¯‘å®Œæˆåï¼Œåœ¨ builld/ æ–‡ä»¶å¤¹ä¸‹ä¼šçœ‹åˆ°ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶å¤¹ my_tbb_build_release/</span></span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /usr/local/tbb-2020_U3</span><br><span class="line"></span><br><span class="line">sudo cp -r oneTBB-2020_U3/include /usr/local/tbb-2020_U3/include</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å»ºç«‹æ–°å®‰è£…tbbç‰ˆæœ¬çš„ç¬¦å·é“¾æ¥</span></span><br><span class="line">sudo ln -s /usr/local/tbb-2020_U3/include/tbb /usr/local/include/tbb</span><br><span class="line"></span><br><span class="line">sudo cp -r oneTBB-2020_U3/build/my_tbb_build_release /usr/local/tbb-2020_U3/lib</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å»ºç«‹æ–°å®‰è£…tbbç‰ˆæœ¬çš„ç¬¦å·é“¾æ¥</span></span><br><span class="line">sudo ln -s /usr/local/tbb-2020_U3/lib/libtbb.so.2 /usr/local/lib/libtbb.so</span><br><span class="line">sudo ln -s /usr/local/tbb-2020_U3/lib/libtbb.so.2 /usr/local/lib/libtbb.so2</span><br><span class="line">sudo ln -s /usr/local/tbb-2020_U3/lib/libtbbmalloc.so.2 /usr/local/lib/libtbbmalloc.so</span><br><span class="line">sudo ln -s /usr/local/tbb-2020_U3/lib/libtbbmalloc.so.2 /usr/local/lib/libtbbmalloc.so2</span><br><span class="line">sudo ln -s /usr/local/tbb-2020_U3/lib/libtbbmalloc_proxy.so.2 /usr/local/lib/libtbbmalloc_proxy.so</span><br><span class="line">sudo ln -s /usr/local/tbb-2020_U3/lib/libtbbmalloc_proxy.so.2 /usr/local/lib/libtbbmalloc_proxy.so2</span><br></pre></td></tr></table></figure>

<p>ç„¶åæŠŠ åº“æ–‡ä»¶çš„è·¯å¾„å†™å…¥åˆ° ~&#x2F;.bashrcï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;export LD_LIBRARY_PATH=/usr/local/tbb-2020_U3/lib:$LD_LIBRARY_PATH&#x27; &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒé“¾æ¥: <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39779233/article/details/126284595">https://blog.csdn.net/qq_39779233&#x2F;article&#x2F;details&#x2F;126284595</a></p>
<h3 id="jemalloc"><a href="#jemalloc" class="headerlink" title="jemalloc"></a>jemalloc</h3><p>ä¸‹è½½åœ°å€: <a target="_blank" rel="noopener" href="https://github.com/jemalloc/jemalloc/releases">https://github.com/jemalloc/jemalloc/releases</a></p>
<h4 id="ç¼–è¯‘ä¸å®‰è£…"><a href="#ç¼–è¯‘ä¸å®‰è£…" class="headerlink" title="ç¼–è¯‘ä¸å®‰è£…"></a>ç¼–è¯‘ä¸å®‰è£…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">step 1</span></span><br><span class="line">./autogen.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">step 2</span></span><br><span class="line">make</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">step 3</span></span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒé“¾æ¥: <a target="_blank" rel="noopener" href="https://blog.csdn.net/SweeNeil/article/details/94648313">https://blog.csdn.net/SweeNeil/article/details/94648313</a></p>
<h2 id="USAGE"><a href="#USAGE" class="headerlink" title="USAGE"></a>USAGE</h2><h3 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git submodule update --init # only for the first time</span><br><span class="line">mkdir -p build</span><br><span class="line">cd build</span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Release .. &amp;&amp; make</span><br></pre></td></tr></table></figure>
<h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./build/microbench \</span><br><span class="line">--keys_file=./data/dataset \  // æ•°æ®åœ°å€</span><br><span class="line">--keys_file_type=&#123;binary,text&#125; \  // äºŒè¿›åˆ¶ æˆ–è€… æ–‡æœ¬</span><br><span class="line">--read=0.5 --insert=0.5 \ </span><br><span class="line">--operations_num=800000000 \ </span><br><span class="line">--table_size=-1 \ // æ‰€ä½¿ç”¨çš„æ•°æ®çš„size</span><br><span class="line">--init_table_ratio=0.5 \ //bulk_loadæ‰€ä½¿ç”¨çš„æ•°æ®çš„ç™¾åˆ†æ¯”</span><br><span class="line">--thread_num=24 \</span><br><span class="line">--index=index_name \ //æµ‹è¯•çš„ç´¢å¼•åç§°</span><br></pre></td></tr></table></figure>

<p>å…¶å®ƒå‚æ•°è§å®˜ç½‘:<br><a target="_blank" rel="noopener" href="https://github.com/jingtao8a/GRE">https://github.com/jingtao8a/GRE</a></p>
<h3 id="å¦‚æœè¦æµ‹è¯•æ–°çš„ç´¢å¼•ç»“æ„"><a href="#å¦‚æœè¦æµ‹è¯•æ–°çš„ç´¢å¼•ç»“æ„" class="headerlink" title="å¦‚æœè¦æµ‹è¯•æ–°çš„ç´¢å¼•ç»“æ„"></a>å¦‚æœè¦æµ‹è¯•æ–°çš„ç´¢å¼•ç»“æ„</h3><h4 id="step1"><a href="#step1" class="headerlink" title="step1"></a>step1</h4><p>src&#x2F;competitor&#x2F;competitor.h<br>get_indexå‡½æ•°ä¸­æ·»åŠ å¯¹åº”çš„index_type<br><img src="/../images/GRE%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/6.png" alt="img"></p>
<h4 id="step2"><a href="#step2" class="headerlink" title="step2"></a>step2</h4><p>åœ¨ src&#x2F;competitor ä¸‹æ”¾ç½®æºä»£ç  new_index_name&#x2F;src<br>ç¼–å†™æ¥å£æ–‡ä»¶ src&#x2F;competitor&#x2F;new_index_name.h</p>
<p>ä»¥lippçš„æ¥å£æ–‡ä»¶ä¸ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;./src/src/core/lipp.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;../indexInterface.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">KEY_TYPE</span>, <span class="keyword">class</span> <span class="title class_">PAYLOAD_TYPE</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LIPPInterface</span> : <span class="keyword">public</span> indexInterface&lt;KEY_TYPE, PAYLOAD_TYPE&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(Param *param = <span class="literal">nullptr</span>)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bulk_load</span><span class="params">(std::pair &lt;KEY_TYPE, PAYLOAD_TYPE&gt; *key_value, <span class="type">size_t</span> num, Param *param = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">get</span><span class="params">(KEY_TYPE key, PAYLOAD_TYPE &amp;val, Param *param = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">put</span><span class="params">(KEY_TYPE key, PAYLOAD_TYPE value, Param *param = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">update</span><span class="params">(KEY_TYPE key, PAYLOAD_TYPE value, Param *param = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">remove</span><span class="params">(KEY_TYPE key, Param *param = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">scan</span><span class="params">(KEY_TYPE key_low_bound, <span class="type">size_t</span> key_num, std::pair &lt;KEY_TYPE, PAYLOAD_TYPE&gt; *result,</span></span></span><br><span class="line"><span class="params"><span class="function">                Param *param = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">memory_consumption</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> lipp.<span class="built_in">total_size</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    LIPP &lt;KEY_TYPE, PAYLOAD_TYPE&gt; lipp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">KEY_TYPE</span>, <span class="keyword">class</span> <span class="title class_">PAYLOAD_TYPE</span>&gt;</span><br><span class="line"><span class="type">void</span> LIPPInterface&lt;KEY_TYPE, PAYLOAD_TYPE&gt;::<span class="built_in">bulk_load</span>(std::pair &lt;KEY_TYPE, PAYLOAD_TYPE&gt; *key_value, <span class="type">size_t</span> num,</span><br><span class="line">                                                      Param *param) &#123;</span><br><span class="line">    lipp.<span class="built_in">bulk_load</span>(key_value, <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(num));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">KEY_TYPE</span>, <span class="keyword">class</span> <span class="title class_">PAYLOAD_TYPE</span>&gt;</span><br><span class="line"><span class="type">bool</span> LIPPInterface&lt;KEY_TYPE, PAYLOAD_TYPE&gt;::<span class="built_in">get</span>(KEY_TYPE key, PAYLOAD_TYPE &amp;val, Param *param) &#123;</span><br><span class="line">    <span class="type">bool</span> exist;</span><br><span class="line">    val = lipp.<span class="built_in">at</span>(key, <span class="literal">false</span>, exist);</span><br><span class="line">    <span class="keyword">return</span> exist;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">KEY_TYPE</span>, <span class="keyword">class</span> <span class="title class_">PAYLOAD_TYPE</span>&gt;</span><br><span class="line"><span class="type">bool</span> LIPPInterface&lt;KEY_TYPE, PAYLOAD_TYPE&gt;::<span class="built_in">put</span>(KEY_TYPE key, PAYLOAD_TYPE value, Param *param) &#123;</span><br><span class="line">    <span class="keyword">return</span> lipp.<span class="built_in">insert</span>(key, value);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">KEY_TYPE</span>, <span class="keyword">class</span> <span class="title class_">PAYLOAD_TYPE</span>&gt;</span><br><span class="line"><span class="type">bool</span> LIPPInterface&lt;KEY_TYPE, PAYLOAD_TYPE&gt;::<span class="built_in">update</span>(KEY_TYPE key, PAYLOAD_TYPE value, Param *param) &#123;</span><br><span class="line">    <span class="keyword">return</span> lipp.<span class="built_in">update</span>(key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">KEY_TYPE</span>, <span class="keyword">class</span> <span class="title class_">PAYLOAD_TYPE</span>&gt;</span><br><span class="line"><span class="type">bool</span> LIPPInterface&lt;KEY_TYPE, PAYLOAD_TYPE&gt;::<span class="built_in">remove</span>(KEY_TYPE key, Param *param) &#123;</span><br><span class="line">    <span class="keyword">return</span> lipp.<span class="built_in">remove</span>(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">KEY_TYPE</span>, <span class="keyword">class</span> <span class="title class_">PAYLOAD_TYPE</span>&gt;</span><br><span class="line"><span class="type">size_t</span> LIPPInterface&lt;KEY_TYPE, PAYLOAD_TYPE&gt;::<span class="built_in">scan</span>(KEY_TYPE key_low_bound, <span class="type">size_t</span> key_num,</span><br><span class="line">                                                   std::pair &lt;KEY_TYPE, PAYLOAD_TYPE&gt; *result,</span><br><span class="line">                                                   Param *param) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!result) &#123;</span><br><span class="line">        result = <span class="keyword">new</span> std::pair &lt;KEY_TYPE, PAYLOAD_TYPE&gt;[key_num];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lipp.<span class="built_in">range_query_len</span>(result, key_low_bound, key_num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://jingtao8a.github.io/2024/02/29/cmu15445-project4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iverson.jpg">
      <meta itemprop="name" content="jingtao8a">
      <meta itemprop="description" content="this is life, full of ups and down">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jingtao8a's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/29/cmu15445-project4/" class="post-title-link" itemprop="url">cmu15445-project4</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-02-29 04:11:36" itemprop="dateCreated datePublished" datetime="2024-02-29T04:11:36-08:00">2024-02-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-03-04 05:59:21" itemprop="dateModified" datetime="2024-03-04T05:59:21-08:00">2024-03-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cmu15445-2023/" itemprop="url" rel="index"><span itemprop="name">cmu15445-2023</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Concurrency-Control-Theory"><a href="#Concurrency-Control-Theory" class="headerlink" title="Concurrency Control Theory"></a>Concurrency Control Theory</h2><h3 id="formal-Definitions"><a href="#formal-Definitions" class="headerlink" title="formal Definitions"></a>formal Definitions</h3><p>Database: A fixed set of named data objects (e.g., A, B, C, â€¦)<br>Transaction: A sequence of read and write operations (e.g., R(A), W(B), â€¦)</p>
<p>transactionçš„æ­£ç¡®æ€§æ ‡å‡†ACIDï¼š</p>
<ul>
<li>Atomicity: åŸå­æ€§ â€œall or nothingâ€</li>
<li>Consistency: ä¸€è‡´æ€§ â€œit looks correct to meâ€</li>
<li>Isolation: éš”ç¦»æ€§ â€œas if aloneâ€</li>
<li>Durability: æŒä¹…æ€§ â€œsurvive failuresâ€</li>
</ul>
<h3 id="Conflicting-Operations"><a href="#Conflicting-Operations" class="headerlink" title="Conflicting Operations"></a>Conflicting Operations</h3><p>å¤šä¸ªtransactionå¹¶å‘æ‰§è¡Œæ—¶ä¼šå‘ç”Ÿå†²çª:</p>
<ul>
<li>è¯»å†™å†²çª(R-W)</li>
<li>å†™è¯»å†²çª(W-R)</li>
<li>å†™å†™å†²çª(W-W)</li>
</ul>
<p>è¯»å†™å†²çªé€ æˆçš„é—®é¢˜ï¼š<br></p>
<ul>
<li>ä¸å¯é‡å¤è¯»(åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœå‡ºç°å‰åä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†[ä¸å¯é‡å¤è¯»]çš„ç°è±¡)</li>
<li>å¹»è¯»ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢æŸä¸ªç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„[è®°å½•æ•°é‡]ï¼Œå‡ºç°å‰åä¸¤æ¬¡æŸ¥è¯¢åˆ°çš„è®°å½•æ•°é‡ä¸ä¸€æ ·</li>
</ul>
<p>å†™è¯»å†²çªé€ æˆçš„é—®é¢˜ï¼š<br></p>
<ul>
<li>è„è¯»(ä¸€ä¸ªäº‹åŠ¡[è¯»åˆ°]äº†å¦ä¸€ä¸ª[æœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®],å°±æ„å‘³ç€å‘ç”Ÿäº†[è„è¯»]ç°è±¡)</li>
</ul>
<p>å†™å†™å†²çªé€ æˆçš„é—®é¢˜: <br></p>
<ul>
<li>ä¸¢å¤±ä¿®æ”¹</li>
</ul>
<p><img src="/../images/cmu15445-project4/2.png" alt="img"><br><img src="/../images/cmu15445-project4/3.png" alt="img"><br><img src="/../images/cmu15445-project4/4.png" alt="img"></p>
<blockquote>
<p>MySQL InnoDBå¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«è™½ç„¶æ˜¯[å¯é‡å¤è¯»]ï¼Œä½†æ˜¯å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¹»è¯»ç°è±¡ï¼Œå¹¶æ²¡æœ‰è§£å†³å¹»è¯» <a target="_blank" rel="noopener" href="https://xiaolincoding.com/mysql/transaction/phantom.html">å‚è€ƒæ–‡ç« </a><br></p>
</blockquote>
<hr>
<blockquote>
<p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§:</p>
<ul>
<li>æ™®é€šselectè¯­å¥(å¿«ç…§è¯»),é€šè¿‡MVCCæ–¹å¼è§£å†³äº†å¹»è¯»é—®é¢˜</li>
<li>select â€¦ for updateè¯­å¥(å½“å‰è¯»)ï¼Œé€šè¿‡next-key lock(è®°å½•é” + é—´éš™é”)æ–¹å¼è§£å†³äº†å¹»è¯»</li>
</ul>
</blockquote>
<h3 id="Read-Viewåœ¨MVCCé‡Œå¦‚ä½•å·¥ä½œçš„"><a href="#Read-Viewåœ¨MVCCé‡Œå¦‚ä½•å·¥ä½œçš„" class="headerlink" title="Read Viewåœ¨MVCCé‡Œå¦‚ä½•å·¥ä½œçš„?"></a>Read Viewåœ¨MVCCé‡Œå¦‚ä½•å·¥ä½œçš„?</h3><p>Read Viewæœ‰å››ä¸ªé‡è¦çš„å­—æ®µ<br><br>å››ä¸ªå­—æ®µåªæœ‰m_idsæ˜¯ä¸€ä¸ªé›†åˆï¼Œcreator_trx_idåœ¨m_idsé›†åˆä¸­ï¼Œ<br>min_trx_idæ˜¯m_idsé›†åˆçš„æœ€å°å€¼<br><img src="/../images/cmu15445-project4/5.png" alt="img"></p>
<p>è®°å½•çš„ä¸¤ä¸ªéšè—åˆ—<br><img src="/../images/cmu15445-project4/6.png" alt="img"></p>
<ul>
<li>trx_idï¼Œå½“ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œå°±ä¼šæŠŠè¯¥äº‹åŠ¡çš„äº‹åŠ¡ id è®°å½•åœ¨ trx_id éšè—åˆ—é‡Œï¼›</li>
<li>roll_pointerï¼Œæ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§ç‰ˆæœ¬çš„è®°å½•å†™å…¥åˆ° undo æ—¥å¿—ä¸­ï¼Œç„¶åè¿™ä¸ªéšè—åˆ—æ˜¯ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ¯ä¸€ä¸ªæ—§ç‰ˆæœ¬è®°å½•ï¼Œäºæ˜¯å°±å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°ä¿®æ”¹å‰çš„è®°å½•</li>
</ul>
<p>åœ¨åˆ›å»ºReadViewåï¼Œä¸€ä¸ªäº‹åŠ¡å»è®¿é—®è®°å½•çš„æ—¶å€™ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°è®°å½•æ€»æ˜¯å¯è§ä¹‹å¤–ï¼Œè¿˜æœ‰å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li>å¦‚æœè®°å½•çš„trx_idå°äºReadViewçš„min_trx_idï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨åˆ›å»º Read View å‰å·²ç»æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡å¯è§</li>
<li>å¦‚æœè®°å½•çš„trx_idå¤§äºç­‰äºReadViewä¸­çš„max_trx_id,è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨åˆ›å»º Read View åæ‰å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§</li>
<li>å¦‚æœè®°å½•çš„ trx_id å€¼åœ¨ Read View çš„ min_trx_id å’Œ max_trx_id ä¹‹é—´ï¼Œéœ€è¦åˆ¤æ–­ trx_id æ˜¯å¦åœ¨ m_ids åˆ—è¡¨ä¸­ï¼š<ul>
<li>å¦‚æœè®°å½•çš„ trx_id åœ¨ m_ids åˆ—è¡¨ä¸­ï¼Œè¡¨ç¤ºç”Ÿæˆè¯¥ç‰ˆæœ¬è®°å½•çš„æ´»è·ƒäº‹åŠ¡ä¾ç„¶æ´»è·ƒç€ï¼ˆè¿˜æ²¡æäº¤äº‹åŠ¡ï¼‰ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ã€‚</li>
<li>å¦‚æœè®°å½•çš„ trx_id ä¸åœ¨ m_idsåˆ—è¡¨ä¸­ï¼Œè¡¨ç¤ºç”Ÿæˆè¯¥ç‰ˆæœ¬è®°å½•çš„æ´»è·ƒäº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡å¯è§ã€‚</li>
</ul>
</li>
</ul>
<h3 id="Two-Phase-Locking-ä¸¤é˜¶æ®µé”"><a href="#Two-Phase-Locking-ä¸¤é˜¶æ®µé”" class="headerlink" title="Two Phase Locking ä¸¤é˜¶æ®µé”"></a>Two Phase Locking ä¸¤é˜¶æ®µé”</h3><p>2PLå°†äº‹åŠ¡åˆ’åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ:</p>
<ul>
<li>Growing Phase: åªè·å¾—é”</li>
<li>Shrink Phase: åªé‡Šæ”¾é”</li>
</ul>
<p><img src="/../images/cmu15445-project4/7.png" alt="img"><br>2PLæœ¬èº«å·²ç»è¶³å¤Ÿä¿è¯scheduleæ˜¯seriableçš„ï¼Œä½†2PLå¯èƒ½å¯¼è‡´cascading abortsï¼Œä¸¾ä¾‹å¦‚ä¸‹:<br><img src="/../images/cmu15445-project4/8.png" alt="img"></p>
<p>äºæ˜¯å¼•å…¥2PLçš„å¢å¼ºç‰ˆå˜ç§ï¼ŒRigorous 2PLï¼Œåè€…æ¯ä¸ªäº‹åŠ¡åœ¨ç»“æŸä¹‹å‰ï¼Œå…¶å†™è¿‡çš„æ•°æ®ä¸èƒ½è¢«å…¶å®ƒäº‹åŠ¡è¯»å–æˆ–è€…é‡å†™</p>
<p><img src="/../images/cmu15445-project4/9.png" alt="img"></p>
<h3 id="Deadlock-Detection-Prevention"><a href="#Deadlock-Detection-Prevention" class="headerlink" title="Deadlock Detection &amp; Prevention"></a>Deadlock Detection &amp; Prevention</h3><p>2PL æ— æ³•é¿å…çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ­»é”ï¼Œè§£å†³æ–¹æ¡ˆï¼š<br></p>
<h4 id="Deadlock-Detection-äº‹åæ£€æµ‹"><a href="#Deadlock-Detection-äº‹åæ£€æµ‹" class="headerlink" title="Deadlock Detection äº‹åæ£€æµ‹"></a>Deadlock Detection äº‹åæ£€æµ‹</h4><p>ä¸ºäº†æ£€æµ‹æ­»é”ï¼ŒDBMS ä¼šç»´æŠ¤ä¸€å¼  waits-for graphï¼Œæ¥è·Ÿè¸ªæ¯ä¸ªäº‹åŠ¡æ­£åœ¨ç­‰å¾… (é‡Šæ”¾é”) çš„å…¶å®ƒäº‹åŠ¡ï¼Œç„¶åç³»ç»Ÿä¼šå®šæœŸåœ°æ£€æŸ¥ waits-for graphï¼Œçœ‹å…¶ä¸­æ˜¯å¦æœ‰æˆç¯ï¼Œå¦‚æœæˆç¯äº†å°±è¦å†³å®šå¦‚ä½•æ‰“ç ´è¿™ä¸ªç¯ã€‚<br><br>waits-for graph ä¸­çš„èŠ‚ç‚¹æ˜¯äº‹åŠ¡ï¼Œä» Ti åˆ° Tj çš„è¾¹å°±è¡¨ç¤º Ti æ­£åœ¨ç­‰å¾… Tj é‡Šæ”¾é”ï¼Œä¸¾ä¾‹å¦‚ä¸‹<br><img src="/../images/cmu15445-project4/10.png" alt="img"><br>å½“ DBMS æ£€æµ‹åˆ°æ­»é”æ—¶ï¼Œå®ƒä¼šé€‰æ‹©ä¸€ä¸ª â€œå—å®³è€…â€ (äº‹åŠ¡)ï¼Œå°†è¯¥äº‹åŠ¡å›æ»šï¼Œæ‰“ç ´ç¯å½¢ä¾èµ–ï¼Œè€Œè¿™ä¸ª â€œå—å®³è€…â€ å°†ä¾é é…ç½®æˆ–è€…åº”ç”¨å±‚é€»è¾‘é‡è¯•æˆ–ä¸­æ­¢ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªè®¾è®¡å†³å®šï¼š</p>
<ol>
<li>æ£€æµ‹æ­»é”çš„é¢‘ç‡</li>
<li>å¦‚ä½•é€‰æ‹©åˆé€‚çš„ â€œå—å®³è€…â€</li>
</ol>
<p>æ£€æµ‹æ­»é”çš„é¢‘ç‡è¶Šé«˜ï¼Œé™·å…¥æ­»é”çš„äº‹åŠ¡ç­‰å¾…çš„æ—¶é—´è¶ŠçŸ­ï¼Œä½†æ¶ˆè€—çš„ cpu ä¹Ÿå°±è¶Šå¤šã€‚æ‰€ä»¥è¿™æ˜¯ä¸ªå…¸å‹çš„ trade-offï¼Œé€šå¸¸æœ‰ä¸€ä¸ªè°ƒä¼˜çš„å‚æ•°ä¾›ç”¨æˆ·é…ç½®ã€‚</p>
<p>é€‰æ‹© â€œå—å®³è€…â€ çš„æŒ‡æ ‡å¯èƒ½æœ‰å¾ˆå¤šï¼šäº‹åŠ¡æŒç»­æ—¶é—´ã€äº‹åŠ¡çš„è¿›åº¦ã€äº‹åŠ¡é”ä½çš„æ•°æ®æ•°é‡ã€çº§è”äº‹åŠ¡çš„æ•°é‡ã€äº‹åŠ¡æ›¾ç»é‡å¯çš„æ¬¡æ•°ç­‰ç­‰ã€‚åœ¨é€‰æ‹©å®Œ â€œå—å®³è€…â€ åï¼ŒDBMS è¿˜æœ‰ä¸€ä¸ªè®¾è®¡å†³å®šéœ€è¦åšï¼šå®Œå…¨å›æ»šè¿˜æ˜¯å›æ»šåˆ°è¶³å¤Ÿæ¶ˆé™¤ç¯å½¢ä¾èµ–å³å¯ã€‚</p>
<h4 id="Deadlock-Prevention-äº‹å‰é˜»æ­¢"><a href="#Deadlock-Prevention-äº‹å‰é˜»æ­¢" class="headerlink" title="Deadlock Prevention äº‹å‰é˜»æ­¢"></a>Deadlock Prevention äº‹å‰é˜»æ­¢</h4><p>é€šå¸¸ prevention ä¼šæŒ‰ç…§äº‹åŠ¡çš„å¹´é¾„æ¥èµ‹äºˆä¼˜å…ˆçº§ï¼Œäº‹åŠ¡çš„æ—¶é—´æˆ³è¶Šè€ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚æœ‰ä¸¤ç§ prevention çš„ç­–ç•¥ï¼š <br></p>
<ul>
<li>Old Waits for Youngï¼šå¦‚æœ requesting txn ä¼˜å…ˆçº§æ¯” holding txn æ›´é«˜åˆ™ç­‰å¾…åè€…é‡Šæ”¾é”ï¼›æ›´ä½åˆ™è‡ªè¡Œä¸­æ­¢<br></li>
<li>Young Waits for Oldï¼šå¦‚æœ requesting txn ä¼˜å…ˆçº§æ¯” holding txn æ›´é«˜åˆ™åè€…è‡ªè¡Œä¸­æ­¢é‡Šæ”¾é”ï¼Œè®©å‰è€…è·å–é”ï¼Œå¦åˆ™ requesting txn ç­‰å¾… holding txn é‡Šæ”¾é”</li>
</ul>
<p>ä¸¾ä¾‹å¦‚ä¸‹:</p>
<p><img src="/../images/cmu15445-project4/11.png" alt="img"></p>
<p>æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶æ˜¯<br><br>1.äº’æ–¥ 2.è¯·æ±‚ä¸ä¿æŒ 3.ä¸å¯æŠ¢å  4.å¾ªç¯ç­‰å¾…<br></p>
<h2 id="Task-1-Lock-Manager"><a href="#Task-1-Lock-Manager" class="headerlink" title="Task#1 Lock Manager"></a>Task#1 Lock Manager</h2><p>äº”ç§é” S X IS IX SIX<br><img src="/../images/cmu15445-project4/12.png" alt="img"><br>è¿™é‡Œåªå®ç°ä¸‰ç§éš”ç¦»çº§åˆ«READ_UNCOMMITTEDã€READ_COMMITTEDã€REPEATABLE_READ</p>
<h3 id="LOCK-NOTE"><a href="#LOCK-NOTE" class="headerlink" title="LOCK NOTE"></a>LOCK NOTE</h3><ol>
<li><p>GENERAL BEHAVIOUR:</p>
<ul>
<li>Both LockTable() and LockRow() are blocking methods; they should wait till the lock is granted and then return.</li>
<li>If the transaction was aborted in the meantime, do not grant the lock and return false.</li>
</ul>
</li>
<li><p>MULTIPLE TRANSACTIONS:</p>
<ul>
<li>LockManager should maintain a queue for each resource; locks should be granted to transactions in a FIFO manner.</li>
<li>If there are multiple compatible lock requests, all should be granted at the same time</li>
<li>as long as FIFO is honoured.</li>
</ul>
</li>
<li><p>SUPPORTED LOCK MODES:</p>
<ul>
<li>Table locking should support all lock modes.</li>
<li>Row locking should not support Intention locks. Attempting this should set the TransactionState as</li>
<li>ABORTED and throw a TransactionAbortException (ATTEMPTED_INTENTION_LOCK_ON_ROW)</li>
</ul>
</li>
<li><p>ISOLATION LEVEL:</p>
<ul>
<li><p>REPEATABLE_READ:<br><br>  The transaction is required to take all locks.<br>  All locks are allowed in the GROWING state<br>  No locks are allowed in the SHRINKING state</p>
</li>
<li><p>READ_COMMITTED:<br><br> The transaction is required to take all locks.<br> All locks are allowed in the GROWING state<br> Only IS, S locks are allowed in the SHRINKING state</p>
</li>
<li><p>READ_UNCOMMITTED:<br><br> The transaction is required to take only IX, X locks.<br> X, IX locks are allowed in the GROWING state.<br> S, IS, SIX locks are never allowed</p>
</li>
</ul>
</li>
<li><p>MULTILEVEL LOCKING:</p>
<ul>
<li>While locking rows, Lock() should ensure that the transaction has an appropriate lock on the table which the row</li>
</ul>
<p> belongs to. For instance, if an exclusive lock is attempted on a row, the transaction must hold either X, IX, or SIX on the table. If such a lock does not exist on the table, Lock() should set the TransactionState as ABORTED and throw a TransactionAbortException (TABLE_LOCK_NOT_PRESENT)</p>
</li>
<li><p>LOCK UPGRADE:<br><br>Calling Lock() on a resource that is already locked should have the following behaviour:    </p>
<ul>
<li>If requested lock mode is the same as that of the lock presently held, Lock() should return true since it already has the lock.</li>
<li>If requested lock mode is different, Lock() should upgrade the lock held by the transaction.<br><br> While upgrading, only the following transitions should be allowed:<br><ol>
<li>IS -&gt; [S, X, IX, SIX]</li>
<li>S -&gt; [X, SIX]</li>
<li>IX -&gt; [X, SIX]</li>
<li>SIX -&gt; [X]</li>
</ol>
</li>
</ul>
<ul>
<li>Any other upgrade is considered incompatible, and such an attempt should set the TransactionState as ABORTED and throw a TransactionAbortException (INCOMPATIBLE_UPGRADE)</li>
<li>Furthermore, only one transaction should be allowed to upgrade its lock on a given resource. Multiple concurrent lock upgrades on the same resource should set the TransactionState as ABORTED and throw a TransactionAbortException (UPGRADE_CONFLICT).</li>
</ul>
</li>
</ol>
<h3 id="UNLOCK-NOTE"><a href="#UNLOCK-NOTE" class="headerlink" title="UNLOCK NOTE"></a>UNLOCK NOTE</h3><ol>
<li>GENERAL BEHAVIOUR:<ul>
<li>Both UnlockTable() and UnlockRow() should release the lock on the resource and return. Both should ensure that the transaction currently holds a lock on the resource it is attempting to unlock.</li>
</ul>
<p>If not, LockManager should set the TransactionState as ABORTED and throw a TransactionAbortException (ATTEMPTED_UNLOCK_BUT_NO_LOCK_HELD)</p>
<ul>
<li>Additionally, unlocking a table should only be allowed if the transaction does not hold locks on any row on that table. If the transaction holds locks on rows of the table, Unlock should set the Transaction State as ABORTED and throw a TransactionAbortException (TABLE_UNLOCKED_BEFORE_UNLOCKING_ROWS).</li>
<li>Finally, unlocking a resource should also grant any new lock requests for the resource (if possible).</li>
</ul>
</li>
<li>TRANSACTION STATE UPDATE<ul>
<li>REPEATABLE_READ:<br><br>   Unlocking S&#x2F;X locks should set the transaction state to SHRINKING</li>
<li>READ_COMMITTED:<br><br>   Unlocking X locks should set the transaction state to SHRINKING.<br><br>   Unlocking S locks does not affect transaction state.</li>
<li>READ_UNCOMMITTED:<br><br>   Unlocking X locks should set the transaction state to SHRINKING.<br><br>   S locks are not permitted under READ_UNCOMMITTED.<br><br>   The behaviour upon unlocking an S lock under this isolation level is undefined.</li>
</ul>
</li>
</ol>
<p><br><br><br></p>
<ul>
<li>LockTable(Transaction, LockMode, TableOID)</li>
<li>UnlockTable(Transction, TableOID)</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">LockManager::LockTable</span><span class="params">(Transaction *txn, LockMode lock_mode, <span class="type">const</span> <span class="type">table_oid_t</span> &amp;oid)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">LockTableDirectlyOrNot</span>(txn, lock_mode, oid, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">LockManager::LockTableDirectlyOrNot</span><span class="params">(Transaction *txn, LockMode lock_mode, <span class="type">const</span> <span class="type">table_oid_t</span> &amp;oid, <span class="type">bool</span> directly)</span></span></span><br><span class="line"><span class="function">    -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  <span class="keyword">auto</span> txn_state = txn-&gt;<span class="built_in">GetState</span>();</span><br><span class="line">  <span class="keyword">auto</span> iso_level = txn-&gt;<span class="built_in">GetIsolationLevel</span>();</span><br><span class="line">  <span class="keyword">if</span> (txn_state == TransactionState::COMMITTED || txn_state == TransactionState::ABORTED) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//äº‹åŠ¡å·²ç»æäº¤æˆ–ç»ˆæ­¢ï¼Œè¿”å›false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">switch</span> (iso_level) &#123;</span><br><span class="line">    <span class="keyword">case</span> IsolationLevel::REPEATABLE_READ:</span><br><span class="line">      <span class="keyword">if</span> (txn_state == TransactionState::SHRINKING) &#123;<span class="comment">//REPEATABLE_READçº§åˆ«ä¸‹,SHRINKINGé˜¶æ®µä¸å¯åŠ é”</span></span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::LOCK_ON_SHRINKING, directly);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> IsolationLevel::READ_COMMITTED:</span><br><span class="line">      <span class="keyword">if</span> (txn_state == TransactionState::SHRINKING) &#123;</span><br><span class="line">        <span class="comment">//READ_COMMITTEDçº§åˆ«ä¸‹ï¼ŒSHRINGKINGé˜¶æ®µåªå¯åŠ ISã€Sé”</span></span><br><span class="line">        <span class="keyword">if</span> (lock_mode != LockMode::INTENTION_SHARED &amp;&amp; lock_mode != LockMode::SHARED) &#123;</span><br><span class="line">          <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::LOCK_ON_SHRINKING, directly);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> IsolationLevel::READ_UNCOMMITTED:</span><br><span class="line">      <span class="comment">//READ_UNCOMMITTEDçº§åˆ«ä¸‹,SHRINKINGé˜¶æ®µä¸å¯åŠ é”</span></span><br><span class="line">      <span class="keyword">if</span> (txn_state == TransactionState::SHRINKING) &#123;</span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::LOCK_ON_SHRINKING, directly);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//READ_UNCOMMITTEDçº§åˆ«ä¸‹,åªå¯ä»¥åŠ IXå’ŒXé”</span></span><br><span class="line">      <span class="keyword">if</span> (lock_mode != LockMode::INTENTION_EXCLUSIVE &amp;&amp; lock_mode != LockMode::EXCLUSIVE) &#123;</span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::LOCK_SHARED_ON_READ_UNCOMMITTED, directly);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">UNREACHABLE</span>(<span class="string">&quot;wrong IsolationLevel&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  table_lock_map_latch_.<span class="built_in">lock</span>();</span><br><span class="line">  <span class="keyword">if</span> (table_lock_map_.<span class="built_in">count</span>(oid) == <span class="number">0</span>) &#123;</span><br><span class="line">    table_lock_map_[oid] = std::<span class="built_in">make_shared</span>&lt;LockRequestQueue&gt;();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">auto</span> lrq = table_lock_map_[oid];<span class="comment">//æ‹¿åˆ°è¯¥tableçš„LockRequestQueue</span></span><br><span class="line">  <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(lrq-&gt;latch_)</span></span>;</span><br><span class="line">  table_lock_map_latch_.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ£€æŸ¥æ­¤é”çš„è¯·æ±‚æ˜¯å¦ä¸ºä¸€æ¬¡é”å‡çº§</span></span><br><span class="line">  <span class="type">bool</span> upgrade = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> iter = lrq-&gt;request_queue_.<span class="built_in">begin</span>(); iter != lrq-&gt;request_queue_.<span class="built_in">end</span>(); iter++) &#123;<span class="comment">//éå†LockRequestQueue</span></span><br><span class="line">    <span class="keyword">auto</span> lr = *iter;</span><br><span class="line">    <span class="keyword">if</span> (lr-&gt;txn_id_ == txn-&gt;<span class="built_in">GetTransactionId</span>()) &#123;  <span class="comment">// åŒä¸€ä¸ªäº‹åŠ¡å¯¹ç›¸åŒtableè¯·æ±‚åŠ é”</span></span><br><span class="line">      <span class="keyword">if</span> (lr-&gt;lock_mode_ == lock_mode) &#123;           <span class="comment">// åŠ é”çš„ç±»å‹ç›¸åŒ,ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (lrq-&gt;upgrading_ != INVALID_TXN_ID) &#123;  <span class="comment">// æœ‰äº‹åŠ¡æ­£åœ¨å¯¹è¯¥resourceè¿›è¡Œé”å‡çº§</span></span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::UPGRADE_CONFLICT, directly);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">CanLockUpgrade</span>(lr-&gt;lock_mode_, lock_mode)) &#123;  <span class="comment">// ä¸èƒ½å¤Ÿè¿›è¡Œé”å‡çº§</span></span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::INCOMPATIBLE_UPGRADE, directly);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//é”å‡çº§</span></span><br><span class="line">      lrq-&gt;upgrading_ = txn-&gt;<span class="built_in">GetTransactionId</span>();</span><br><span class="line">      lrq-&gt;request_queue_.<span class="built_in">erase</span>(iter);<span class="comment">//å°†lrä»LockRequestQueueä¸­åˆ é™¤</span></span><br><span class="line">      <span class="built_in">RemoveFromTxnTableLockSet</span>(txn, lr-&gt;lock_mode_, oid);<span class="comment">//å°†txnäº‹åŠ¡æŒæœ‰è¯¥tableçš„é”åˆ é™¤</span></span><br><span class="line">      <span class="keyword">delete</span> lr;  <span class="comment">// é˜²æ­¢å†…å­˜æ³„éœ²</span></span><br><span class="line">      lrq-&gt;request_queue_.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">LockRequest</span>(txn-&gt;<span class="built_in">GetTransactionId</span>(), lock_mode, oid));<span class="comment">//åŠ å…¥LockRequest</span></span><br><span class="line">      upgrade = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¸æ˜¯é”å‡çº§</span></span><br><span class="line">  <span class="keyword">if</span> (!upgrade) &#123;</span><br><span class="line">    lrq-&gt;request_queue_.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">LockRequest</span>(txn-&gt;<span class="built_in">GetTransactionId</span>(), lock_mode, oid));<span class="comment">//åŠ å…¥LockRequest</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">CanTxnTakeLock</span>(txn, lock_mode, lrq)) &#123;<span class="comment">//åˆ¤æ–­æ˜¯å¦å¯ä»¥ç»™æ”¹TableåŠ é”</span></span><br><span class="line">    lrq-&gt;cv_.<span class="built_in">wait</span>(lock);<span class="comment">//äº’æ–¥é˜»å¡</span></span><br><span class="line">    <span class="comment">// å¯èƒ½æ­»é”æ£€æµ‹å°†è¯¥äº‹åŠ¡ABORTED æˆ–è€… æ‰‹åŠ¨ABORTè¯¥äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">if</span> (txn-&gt;<span class="built_in">GetState</span>() == TransactionState::ABORTED) &#123;</span><br><span class="line">      <span class="comment">// åˆ é™¤è¯¥äº‹åŠ¡å¯¹è¯¥èµ„æºçš„request</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> iter = lrq-&gt;request_queue_.<span class="built_in">begin</span>(); iter != lrq-&gt;request_queue_.<span class="built_in">end</span>(); iter++) &#123;</span><br><span class="line">        <span class="keyword">auto</span> lr = *iter;</span><br><span class="line">        <span class="keyword">if</span> (lr-&gt;txn_id_ == txn-&gt;<span class="built_in">GetTransactionId</span>()) &#123;</span><br><span class="line">          lrq-&gt;request_queue_.<span class="built_in">erase</span>(iter);</span><br><span class="line">          <span class="keyword">delete</span> lr;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      lrq-&gt;cv_.<span class="built_in">notify_all</span>();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">AddIntoTxnTableLockSet</span>(txn, lock_mode, oid);<span class="comment">//è¯¥Tableè·å¾—é”</span></span><br><span class="line">  <span class="comment">// LOG_DEBUG(&quot;txn:%d LockTable %d lock_mode:%d&quot;, txn-&gt;GetTransactionId(), oid, lock_mode);</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">LockManager::CanTxnTakeLock</span><span class="params">(Transaction *txn, LockMode lock_mode,</span></span></span><br><span class="line"><span class="params"><span class="function">                                 std::shared_ptr&lt;LockRequestQueue&gt; &amp;lock_request_queue)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> lr : lock_request_queue-&gt;request_queue_) &#123;</span><br><span class="line">    <span class="keyword">if</span> (lr-&gt;granted_ &amp;&amp; !<span class="built_in">AreLocksCompatible</span>(lock_mode, lr-&gt;lock_mode_)) &#123;  <span class="comment">// å­˜åœ¨é”å†²çª</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é”å‡çº§ä¼˜å…ˆçº§æœ€é«˜</span></span><br><span class="line">  <span class="keyword">if</span> (lock_request_queue-&gt;upgrading_ != INVALID_TXN_ID) &#123;</span><br><span class="line">    <span class="keyword">if</span> (lock_request_queue-&gt;upgrading_ == txn-&gt;<span class="built_in">GetTransactionId</span>()) &#123;  <span class="comment">// äº‹åŠ¡è¿›è¡Œé”å‡çº§</span></span><br><span class="line">      lock_request_queue-&gt;upgrading_ = INVALID_TXN_ID;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> lr : lock_request_queue-&gt;request_queue_) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!lr-&gt;granted_ &amp;&amp; lr-&gt;txn_id_ == txn-&gt;<span class="built_in">GetTransactionId</span>()) &#123;</span><br><span class="line">          lr-&gt;granted_ = <span class="literal">true</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// è¿›è¡Œé”å‡çº§çš„æ˜¯å…¶å®ƒäº‹åŠ¡,é‚£ä¹ˆè¯¥äº‹åŠ¡éœ€è¦ç­‰å¾…</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// éµå¾ªFIFOè§„åˆ™</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> lr : lock_request_queue-&gt;request_queue_) &#123;</span><br><span class="line">    <span class="keyword">if</span> (lr-&gt;txn_id_ == txn-&gt;<span class="built_in">GetTransactionId</span>()) &#123;</span><br><span class="line">      lr-&gt;granted_ = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!lr-&gt;granted_ &amp;&amp; !<span class="built_in">AreLocksCompatible</span>(lock_mode, lr-&gt;lock_mode_)) &#123;  <span class="comment">// é”å†²çª</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">LockManager::UnlockTable</span><span class="params">(Transaction *txn, <span class="type">const</span> <span class="type">table_oid_t</span> &amp;oid)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">CheckAllRowsUnLock</span>(txn, oid)) &#123;<span class="comment">//æ£€æŸ¥è¯¥Tableä¸‹çš„æ‰€æœ‰rowçš„é”æ˜¯å¦é‡Šæ”¾</span></span><br><span class="line">    <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::TABLE_UNLOCKED_BEFORE_UNLOCKING_ROWS, <span class="literal">true</span>);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  table_lock_map_latch_.<span class="built_in">lock</span>();</span><br><span class="line">  <span class="keyword">if</span> (table_lock_map_.<span class="built_in">count</span>(oid) == <span class="number">0</span>) &#123;</span><br><span class="line">    table_lock_map_latch_.<span class="built_in">unlock</span>();</span><br><span class="line">    <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::ATTEMPTED_UNLOCK_BUT_NO_LOCK_HELD, <span class="literal">true</span>);<span class="comment">//è¯¥tableæœªåŠ é”</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">auto</span> lrq = table_lock_map_[oid];</span><br><span class="line">  <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(lrq-&gt;latch_)</span></span>;</span><br><span class="line">  table_lock_map_latch_.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> iter = lrq-&gt;request_queue_.<span class="built_in">begin</span>(); iter != lrq-&gt;request_queue_.<span class="built_in">end</span>(); ++iter) &#123;</span><br><span class="line">    <span class="keyword">auto</span> lr = *iter;</span><br><span class="line">    <span class="keyword">if</span> (lr-&gt;granted_ &amp;&amp; lr-&gt;txn_id_ == txn-&gt;<span class="built_in">GetTransactionId</span>()) &#123;<span class="comment">//æ‰¾åˆ°è¯¥äº‹åŠ¡å¯¹è¯¥tableçš„LockRequest</span></span><br><span class="line">      <span class="keyword">auto</span> iso_level = txn-&gt;<span class="built_in">GetIsolationLevel</span>();</span><br><span class="line">      <span class="keyword">switch</span> (iso_level) &#123;</span><br><span class="line">        <span class="keyword">case</span> IsolationLevel::REPEATABLE_READ:</span><br><span class="line">          <span class="keyword">if</span> (lr-&gt;lock_mode_ == LockMode::SHARED || lr-&gt;lock_mode_ == LockMode::EXCLUSIVE) &#123;</span><br><span class="line">            txn-&gt;<span class="built_in">SetState</span>(TransactionState::SHRINKING);</span><br><span class="line">            <span class="comment">// LOG_DEBUG(&quot;txn:%d be set SHRINGKING&quot;, txn-&gt;GetTransactionId());</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IsolationLevel::READ_COMMITTED:</span><br><span class="line">        <span class="keyword">case</span> IsolationLevel::READ_UNCOMMITTED:</span><br><span class="line">          <span class="keyword">if</span> (lr-&gt;lock_mode_ == LockMode::EXCLUSIVE) &#123;</span><br><span class="line">            txn-&gt;<span class="built_in">SetState</span>(TransactionState::SHRINKING);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="built_in">UNREACHABLE</span>(<span class="string">&quot;wrong IsolationLevel&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">RemoveFromTxnTableLockSet</span>(txn, lr-&gt;lock_mode_, oid);</span><br><span class="line">      <span class="comment">// LOG_DEBUG(&quot;txn:%d UnlockTable %d&quot;, txn-&gt;GetTransactionId(), oid);</span></span><br><span class="line">      lrq-&gt;request_queue_.<span class="built_in">erase</span>(iter);</span><br><span class="line">      <span class="keyword">delete</span> lr;</span><br><span class="line">      lrq-&gt;cv_.<span class="built_in">notify_all</span>();<span class="comment">//èµ„æºé‡Šæ”¾ï¼Œcv_è¿›è¡Œnotify</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::ATTEMPTED_UNLOCK_BUT_NO_LOCK_HELD, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>LockRow(Transaction, LockMode, TableOID, RID)</li>
<li>UnlockRow(Transaction, TableOID, RID, force)<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">LockManager::LockRow</span><span class="params">(Transaction *txn, LockMode lock_mode, <span class="type">const</span> <span class="type">table_oid_t</span> &amp;oid, <span class="type">const</span> RID &amp;rid)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">    <span class="comment">//rowåªèƒ½åŠ Så’ŒEé”</span></span><br><span class="line">  <span class="keyword">if</span> (lock_mode != LockMode::SHARED &amp;&amp; lock_mode != LockMode::EXCLUSIVE) &#123;</span><br><span class="line">    <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::ATTEMPTED_INTENTION_LOCK_ON_ROW, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> txn_state = txn-&gt;<span class="built_in">GetState</span>();</span><br><span class="line">  <span class="keyword">auto</span> iso_level = txn-&gt;<span class="built_in">GetIsolationLevel</span>();</span><br><span class="line">  <span class="keyword">if</span> (txn_state == TransactionState::COMMITTED || txn_state == TransactionState::ABORTED) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">switch</span> (iso_level) &#123;</span><br><span class="line">    <span class="keyword">case</span> IsolationLevel::REPEATABLE_READ:</span><br><span class="line">    <span class="comment">//REPEATABLE_READçº§åˆ«ä¸‹SHRINKINGé˜¶æ®µä¸å¯ä»¥åŠ é”</span></span><br><span class="line">      <span class="keyword">if</span> (txn_state == TransactionState::SHRINKING) &#123;</span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::LOCK_ON_SHRINKING, <span class="literal">true</span>);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> IsolationLevel::READ_COMMITTED:</span><br><span class="line">    <span class="comment">//READ_COMMITTEDçº§åˆ«ä¸‹SHRINKINGé˜¶æ®µåªèƒ½ç»™rowåŠ SHAREDé”</span></span><br><span class="line">      <span class="keyword">if</span> (txn_state == TransactionState::SHRINKING) &#123;</span><br><span class="line">        <span class="keyword">if</span> (lock_mode != LockMode::SHARED) &#123;</span><br><span class="line">          <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::LOCK_ON_SHRINKING, <span class="literal">true</span>);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> IsolationLevel::READ_UNCOMMITTED:</span><br><span class="line">    <span class="comment">//READ_UNCOMMITTEDçº§åˆ«ä¸‹SHRINKINGé˜¶æ®µä¸èƒ½åŠ é”</span></span><br><span class="line">      <span class="keyword">if</span> (txn_state == TransactionState::SHRINKING) &#123;</span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::LOCK_ON_SHRINKING, <span class="literal">true</span>);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//READ_UNCOMMITTEDçº§åˆ«ä¸‹ï¼Œåªèƒ½ç»™rowåŠ Xé”</span></span><br><span class="line">      <span class="keyword">if</span> (lock_mode != LockMode::EXCLUSIVE) &#123;</span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::LOCK_SHARED_ON_READ_UNCOMMITTED, <span class="literal">true</span>);<span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">UNREACHABLE</span>(<span class="string">&quot;wrong IsolationLevel&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">CheckAppropriateLockOnTable</span>(txn, oid, lock_mode)) &#123;<span class="comment">//æŸ¥çœ‹è¯¥rowçš„Tableæ˜¯å¦åŠ é”</span></span><br><span class="line">    <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::TABLE_LOCK_NOT_PRESENT, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  row_lock_map_latch_.<span class="built_in">lock</span>();</span><br><span class="line">  <span class="keyword">if</span> (row_lock_map_.<span class="built_in">count</span>(rid) == <span class="number">0</span>) &#123;</span><br><span class="line">    row_lock_map_[rid] = std::<span class="built_in">make_shared</span>&lt;LockRequestQueue&gt;();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">auto</span> lrq = row_lock_map_[rid];</span><br><span class="line">  <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(lrq-&gt;latch_)</span></span>;</span><br><span class="line">  row_lock_map_latch_.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ£€æŸ¥æ˜¯å¦æ˜¯ä¸€æ¬¡é”å‡çº§(S-&gt;X)</span></span><br><span class="line">  <span class="type">bool</span> upgrade = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> iter = lrq-&gt;request_queue_.<span class="built_in">begin</span>(); iter != lrq-&gt;request_queue_.<span class="built_in">end</span>(); iter++) &#123;</span><br><span class="line">    <span class="keyword">auto</span> lr = *iter;</span><br><span class="line">    <span class="keyword">if</span> (lr-&gt;txn_id_ == txn-&gt;<span class="built_in">GetTransactionId</span>()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (lr-&gt;lock_mode_ == lock_mode) &#123;  <span class="comment">// é‡å¤çš„é”</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (lrq-&gt;upgrading_ != INVALID_TXN_ID) &#123;  <span class="comment">// æŠ›å‡º UPGRADE_CONFLICT å¼‚å¸¸</span></span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::UPGRADE_CONFLICT, <span class="literal">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">CanLockUpgrade</span>(lr-&gt;lock_mode_, lock_mode)) &#123;  <span class="comment">// æŠ› INCOMPATIBLE_UPGRADE å¼‚å¸¸</span></span><br><span class="line">        <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::INCOMPATIBLE_UPGRADE, <span class="literal">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      lrq-&gt;upgrading_ = txn-&gt;<span class="built_in">GetTransactionId</span>();</span><br><span class="line">      lrq-&gt;request_queue_.<span class="built_in">erase</span>(iter);</span><br><span class="line">      <span class="built_in">RemoveFromTxnRowLockSet</span>(txn, lr-&gt;lock_mode_, oid, rid);</span><br><span class="line">      <span class="keyword">delete</span> lr;</span><br><span class="line">      lrq-&gt;request_queue_.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">LockRequest</span>(txn-&gt;<span class="built_in">GetTransactionId</span>(), lock_mode, oid, rid));</span><br><span class="line">      upgrade = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!upgrade) &#123;</span><br><span class="line">    lrq-&gt;request_queue_.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">LockRequest</span>(txn-&gt;<span class="built_in">GetTransactionId</span>(), lock_mode, oid, rid));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">CanTxnTakeLock</span>(txn, lock_mode, lrq)) &#123;</span><br><span class="line">    lrq-&gt;cv_.<span class="built_in">wait</span>(lock);</span><br><span class="line">    <span class="comment">// LOG_DEBUG(&quot;txn:%d wake&quot;, txn-&gt;GetTransactionId());</span></span><br><span class="line">    <span class="comment">// æ­»é”æ£€æµ‹ABORTè¯¥äº‹åŠ¡ æˆ–è€… æ‰‹åŠ¨ABORTè¯¥äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">if</span> (txn-&gt;<span class="built_in">GetState</span>() == TransactionState::ABORTED) &#123;</span><br><span class="line">      <span class="comment">// LOG_DEBUG(&quot;txn:%d ABORT&quot;, txn-&gt;GetTransactionId());</span></span><br><span class="line">      <span class="comment">// ç§»é™¤è¯¥äº‹åŠ¡å¯¹è¯¥èµ„æºçš„request</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> iter = lrq-&gt;request_queue_.<span class="built_in">begin</span>(); iter != lrq-&gt;request_queue_.<span class="built_in">end</span>(); iter++) &#123;</span><br><span class="line">        <span class="keyword">auto</span> lr = *iter;</span><br><span class="line">        <span class="keyword">if</span> (lr-&gt;txn_id_ == txn-&gt;<span class="built_in">GetTransactionId</span>()) &#123;</span><br><span class="line">          lrq-&gt;request_queue_.<span class="built_in">erase</span>(iter);</span><br><span class="line">          <span class="keyword">delete</span> lr;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      lrq-&gt;cv_.<span class="built_in">notify_all</span>();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">AddIntoTxnRowLockSet</span>(txn, lock_mode, oid, rid);</span><br><span class="line">  <span class="comment">// LOG_DEBUG(&quot;txn:%d LockRow oid:%d rid:%d:%d lock_mode:%d&quot;, txn-&gt;GetTransactionId(), oid, rid.GetPageId(),</span></span><br><span class="line">  <span class="comment">// rid.GetSlotNum(), lock_mode);</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">LockManager::UnlockRow</span><span class="params">(Transaction *txn, <span class="type">const</span> <span class="type">table_oid_t</span> &amp;oid, <span class="type">const</span> RID &amp;rid, <span class="type">bool</span> force)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  row_lock_map_latch_.<span class="built_in">lock</span>();</span><br><span class="line">  <span class="keyword">if</span> (row_lock_map_.<span class="built_in">count</span>(rid) == <span class="number">0</span>) &#123;</span><br><span class="line">    row_lock_map_latch_.<span class="built_in">unlock</span>();</span><br><span class="line">    <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::ATTEMPTED_UNLOCK_BUT_NO_LOCK_HELD, <span class="literal">true</span>);<span class="comment">//è¯¥rowæœªåŠ é”æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">auto</span> lrq = row_lock_map_[rid];</span><br><span class="line">  <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(lrq-&gt;latch_)</span></span>;</span><br><span class="line">  row_lock_map_latch_.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> iter = lrq-&gt;request_queue_.<span class="built_in">begin</span>(); iter != lrq-&gt;request_queue_.<span class="built_in">end</span>(); ++iter) &#123;</span><br><span class="line">    <span class="keyword">auto</span> lr = *iter;</span><br><span class="line">    <span class="keyword">if</span> (lr-&gt;granted_ &amp;&amp; lr-&gt;txn_id_ == txn-&gt;<span class="built_in">GetTransactionId</span>()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!force) &#123;</span><br><span class="line">        <span class="keyword">auto</span> iso_level = txn-&gt;<span class="built_in">GetIsolationLevel</span>();</span><br><span class="line">        <span class="keyword">switch</span> (iso_level) &#123;</span><br><span class="line">          <span class="keyword">case</span> IsolationLevel::REPEATABLE_READ:</span><br><span class="line">            <span class="keyword">if</span> (lr-&gt;lock_mode_ == LockMode::SHARED || lr-&gt;lock_mode_ == LockMode::EXCLUSIVE) &#123;</span><br><span class="line">              txn-&gt;<span class="built_in">SetState</span>(TransactionState::SHRINKING);</span><br><span class="line">              <span class="comment">// LOG_DEBUG(&quot;txn:%d be set SHRINGKING&quot;, txn-&gt;GetTransactionId());</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> IsolationLevel::READ_COMMITTED:</span><br><span class="line">          <span class="keyword">case</span> IsolationLevel::READ_UNCOMMITTED:</span><br><span class="line">            <span class="keyword">if</span> (lr-&gt;lock_mode_ == LockMode::EXCLUSIVE) &#123;</span><br><span class="line">              txn-&gt;<span class="built_in">SetState</span>(TransactionState::SHRINKING);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">UNREACHABLE</span>(<span class="string">&quot;wrong IsolationLevel&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">RemoveFromTxnRowLockSet</span>(txn, lr-&gt;lock_mode_, oid, rid);</span><br><span class="line">      <span class="comment">// LOG_DEBUG(&quot;txn:%d UnlockRow oid:%d rid:%d:%d&quot;, txn-&gt;GetTransactionId(), oid, rid.GetPageId(),</span></span><br><span class="line">      <span class="comment">// rid.GetSlotNum());</span></span><br><span class="line">      lrq-&gt;request_queue_.<span class="built_in">erase</span>(iter);</span><br><span class="line">      <span class="keyword">delete</span> lr;</span><br><span class="line">      lrq-&gt;cv_.<span class="built_in">notify_all</span>();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">ABORT_FOR_REASON_DIRECTLY_OR_NOT</span>(AbortReason::ATTEMPTED_UNLOCK_BUT_NO_LOCK_HELD, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Task-2-Deadlock-Detection"><a href="#Task-2-Deadlock-Detection" class="headerlink" title="Task #2 - Deadlock Detection"></a>Task #2 - Deadlock Detection</h2><p>é”ç®¡ç†å™¨åº”è¯¥åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œæ­»é”æ£€æµ‹ï¼Œå®šæœŸæ„å»ºç­‰å¾…å›¾å¹¶æ ¹æ®éœ€è¦ä¸­æ­¢äº‹åŠ¡ä»¥æ¶ˆé™¤æ­»é”ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»™LockMangeræ·»åŠ æ­»é”æ£€æµ‹æ‰€éœ€çš„æ•°æ®æˆå‘˜</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LockManager</span> &#123;</span><br><span class="line">  std::atomic&lt;<span class="type">bool</span>&gt; enable_cycle_detection_;</span><br><span class="line">  std::thread *cycle_detection_thread_;</span><br><span class="line">  <span class="comment">/** Waits-for graph representation. */</span></span><br><span class="line">  std::map&lt;<span class="type">txn_id_t</span>, std::set&lt;<span class="type">txn_id_t</span>&gt;&gt; waits_for_;</span><br><span class="line">  <span class="comment">// std::unordered_map&lt;txn_id_t, int&gt; node_value_;</span></span><br><span class="line">  <span class="comment">// std::vector&lt;txn_id_t&gt; route_;</span></span><br><span class="line">  std::vector&lt;<span class="type">txn_id_t</span>&gt; stk_;</span><br><span class="line">  std::unordered_map&lt;<span class="type">txn_id_t</span>, <span class="type">bool</span>&gt; in_stk_;</span><br><span class="line">  std::unordered_map&lt;<span class="type">txn_id_t</span>, <span class="type">bool</span>&gt; has_search_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¼€å¯æ­»é”æ£€æµ‹çš„åå°çº¿ç¨‹<br><img src="/../images/cmu15445-project4/13.png" alt="img"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">LockManager::RunCycleDetection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (enable_cycle_detection_) &#123;</span><br><span class="line">    std::this_thread::<span class="built_in">sleep_for</span>(cycle_detection_interval);</span><br><span class="line">    &#123;</span><br><span class="line">      waits_for_.<span class="built_in">clear</span>();</span><br><span class="line">      <span class="built_in">BuildGraph</span>();<span class="comment">//æ„å»ºç­‰å¾…å›¾</span></span><br><span class="line">      <span class="comment">// PrintGraph();</span></span><br><span class="line">      <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        stk_.<span class="built_in">clear</span>();</span><br><span class="line">        in_stk_.<span class="built_in">clear</span>();</span><br><span class="line">        has_search_.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="type">txn_id_t</span> abort_tid;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">HasCycle</span>(&amp;abort_tid)) &#123;<span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰ç¯ï¼Œå¦‚æœæœ‰è·å–abort_id</span></span><br><span class="line">          <span class="comment">// LOG_DEBUG(&quot;abort_tid:%d&quot;, abort_tid);</span></span><br><span class="line">          <span class="keyword">auto</span> txn = txn_manager_-&gt;<span class="built_in">GetTransaction</span>(abort_tid);</span><br><span class="line">          txn-&gt;<span class="built_in">SetState</span>(TransactionState::ABORTED);</span><br><span class="line">          <span class="built_in">RemoveAllAboutAbortTxn</span>(abort_tid);<span class="comment">//åˆ é™¤æœ‰å‘å›¾ä¸­è¯¥abort_tidçš„æ‰€æœ‰å…¥è¾¹å’Œå‡ºè¾¹</span></span><br><span class="line">          <span class="built_in">WakeAbortedTxn</span>(abort_tid);<span class="comment">//è¯¥abort_tidçš„äº‹åŠ¡æ‰€å æœ‰çš„èµ„æºçš„cv_è¿›è¡Œnotify_all</span></span><br><span class="line">          <span class="comment">// LOG_DEBUG(&quot;dead_detect notify all&quot;);</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HasCycleå‡½æ•°åˆ¤æ–­æ˜¯å¦æœ‰ç¯ï¼Œå¹¶ä¸”è¿”å›ç¯ä¸­æœ€å¤§çš„txn_id</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">LockManager::HasCycle</span><span class="params">(<span class="type">txn_id_t</span> *txn_id)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">any_of</span>(waits_for_.<span class="built_in">begin</span>(), waits_for_.<span class="built_in">end</span>(),</span><br><span class="line">                     [<span class="keyword">this</span>, txn_id](<span class="type">const</span> std::pair&lt;<span class="type">txn_id_t</span>, std::set&lt;<span class="type">txn_id_t</span>&gt;&gt; &amp;p) &#123;</span><br><span class="line">                       <span class="keyword">auto</span> k = p.first;</span><br><span class="line">                       <span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;has_search_[k] &amp;&amp; <span class="built_in">DFS</span>(k)) &#123;</span><br><span class="line">                         <span class="keyword">auto</span> iter = std::<span class="built_in">find</span>(<span class="keyword">this</span>-&gt;stk_.<span class="built_in">begin</span>(), <span class="keyword">this</span>-&gt;stk_.<span class="built_in">end</span>() - <span class="number">1</span>, <span class="keyword">this</span>-&gt;stk_.<span class="built_in">back</span>());</span><br><span class="line">                         *txn_id = <span class="number">-1</span>;</span><br><span class="line">                         <span class="keyword">while</span> (iter != <span class="keyword">this</span>-&gt;stk_.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                           <span class="keyword">if</span> (*iter &gt; *txn_id) &#123;</span><br><span class="line">                             *txn_id = *iter;</span><br><span class="line">                           &#125;</span><br><span class="line">                           ++iter;</span><br><span class="line">                         &#125;</span><br><span class="line">                         <span class="keyword">this</span>-&gt;stk_.<span class="built_in">clear</span>();</span><br><span class="line">                         <span class="keyword">this</span>-&gt;in_stk_.<span class="built_in">clear</span>();</span><br><span class="line">                         <span class="keyword">this</span>-&gt;has_search_.<span class="built_in">clear</span>();</span><br><span class="line">                         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                       &#125;</span><br><span class="line">                       <span class="keyword">this</span>-&gt;stk_.<span class="built_in">clear</span>();</span><br><span class="line">                       <span class="keyword">this</span>-&gt;in_stk_.<span class="built_in">clear</span>();</span><br><span class="line">                       <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                     &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//DFSå‡½æ•°åˆ¤æ–­æ˜¯å¦æœ‰ç¯,txn_idä¸ºéå†çš„èµ·å§‹ç‚¹</span></span><br><span class="line"><span class="comment">//æœ‰ç¯è¿”å›true æ— ç¯è¿”å›false</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">LockManager::DFS</span><span class="params">(<span class="type">txn_id_t</span> txn_id)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  has_search_[txn_id] = <span class="literal">true</span>;</span><br><span class="line">  stk_.<span class="built_in">push_back</span>(txn_id);</span><br><span class="line">  in_stk_[txn_id] = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> id : waits_for_[txn_id]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!has_search_[id]) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">DFS</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (in_stk_[id]) &#123;</span><br><span class="line">      stk_.<span class="built_in">push_back</span>(id);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  stk_.<span class="built_in">pop_back</span>();</span><br><span class="line">  in_stk_[txn_id] = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Task-3-Concurrent-Query-Execution"><a href="#Task-3-Concurrent-Query-Execution" class="headerlink" title="Task #3 - Concurrent Query Execution"></a>Task #3 - Concurrent Query Execution</h2><p>TransactionManagerçš„Abortå‡½æ•°éœ€è¦æ¢å¤Tableå’Œå¯¹åº”Indexçš„åŸå§‹çŠ¶æ€</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TransactionManager::Commit</span><span class="params">(Transaction *txn)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Release all the locks.</span></span><br><span class="line">  <span class="built_in">ReleaseLocks</span>(txn);</span><br><span class="line"></span><br><span class="line">  txn-&gt;<span class="built_in">SetState</span>(TransactionState::COMMITTED);</span><br><span class="line">  <span class="function">std::unique_lock&lt;std::shared_mutex&gt; <span class="title">guard</span><span class="params">(txn_map_mutex_)</span></span>;</span><br><span class="line">  txn_map_.<span class="built_in">erase</span>(txn-&gt;<span class="built_in">GetTransactionId</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TransactionManager::Abort</span><span class="params">(Transaction *txn)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* <span class="doctag">TODO:</span> revert all the changes in write set */</span></span><br><span class="line">  <span class="keyword">while</span> (!txn-&gt;<span class="built_in">GetWriteSet</span>()-&gt;<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">auto</span> twr = txn-&gt;<span class="built_in">GetWriteSet</span>()-&gt;<span class="built_in">back</span>();</span><br><span class="line">    <span class="keyword">if</span> (twr.wtype_ == WType::INSERT) &#123;</span><br><span class="line">      <span class="keyword">auto</span> tuple_meta = twr.table_heap_-&gt;<span class="built_in">GetTupleMeta</span>(twr.rid_);</span><br><span class="line">      tuple_meta.is_deleted_ = <span class="literal">true</span>;</span><br><span class="line">      twr.table_heap_-&gt;<span class="built_in">UpdateTupleMeta</span>(tuple_meta, twr.rid_);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (twr.wtype_ == WType::DELETE) &#123;</span><br><span class="line">      <span class="keyword">auto</span> tuple_meta = twr.table_heap_-&gt;<span class="built_in">GetTupleMeta</span>(twr.rid_);</span><br><span class="line">      tuple_meta.is_deleted_ = <span class="literal">false</span>;</span><br><span class="line">      twr.table_heap_-&gt;<span class="built_in">UpdateTupleMeta</span>(tuple_meta, twr.rid_);</span><br><span class="line">    &#125;</span><br><span class="line">    txn-&gt;<span class="built_in">GetWriteSet</span>()-&gt;<span class="built_in">pop_back</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!txn-&gt;<span class="built_in">GetIndexWriteSet</span>()-&gt;<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">auto</span> iwr = txn-&gt;<span class="built_in">GetIndexWriteSet</span>()-&gt;<span class="built_in">back</span>();</span><br><span class="line">    <span class="keyword">if</span> (iwr.wtype_ == WType::INSERT) &#123;</span><br><span class="line">      iwr.catalog_-&gt;<span class="built_in">GetIndex</span>(iwr.index_oid_)-&gt;index_-&gt;<span class="built_in">DeleteEntry</span>(iwr.tuple_, iwr.rid_, txn);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (iwr.wtype_ == WType::DELETE) &#123;</span><br><span class="line">      iwr.catalog_-&gt;<span class="built_in">GetIndex</span>(iwr.index_oid_)-&gt;index_-&gt;<span class="built_in">InsertEntry</span>(iwr.tuple_, iwr.rid_, txn);</span><br><span class="line">    &#125;</span><br><span class="line">    txn-&gt;<span class="built_in">GetIndexWriteSet</span>()-&gt;<span class="built_in">pop_back</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">ReleaseLocks</span>(txn);</span><br><span class="line"></span><br><span class="line">  txn-&gt;<span class="built_in">SetState</span>(TransactionState::ABORTED);</span><br><span class="line">  <span class="function">std::unique_lock&lt;std::shared_mutex&gt; <span class="title">guard</span><span class="params">(txn_map_mutex_)</span></span>;</span><br><span class="line">  txn_map_.<span class="built_in">erase</span>(txn-&gt;<span class="built_in">GetTransactionId</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SeqScanExecutorä¿®æ”¹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">SeqScanExecutor::Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">auto</span> catalog = exec_ctx_-&gt;<span class="built_in">GetCatalog</span>();</span><br><span class="line">  table_info_ = catalog-&gt;<span class="built_in">GetTable</span>(plan_-&gt;table_oid_);</span><br><span class="line">  <span class="keyword">auto</span> txn = exec_ctx_-&gt;<span class="built_in">GetTransaction</span>();</span><br><span class="line">  <span class="keyword">auto</span> iso_level = txn-&gt;<span class="built_in">GetIsolationLevel</span>();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (exec_ctx_-&gt;<span class="built_in">IsDelete</span>()) &#123;<span class="comment">//å½“å‰è¿›è¡Œçš„sqlæ“ä½œæ˜¯DELETEæˆ–è€…UPDATE</span></span><br><span class="line">      <span class="keyword">auto</span> res =</span><br><span class="line">          exec_ctx_-&gt;<span class="built_in">GetLockManager</span>()-&gt;<span class="built_in">LockTable</span>(txn, LockManager::LockMode::INTENTION_EXCLUSIVE, plan_-&gt;table_oid_);</span><br><span class="line">      <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor LockTable Failed&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!txn-&gt;<span class="built_in">IsTableIntentionExclusiveLocked</span>(plan_-&gt;table_oid_) &amp;&amp;  <span class="comment">// é¿å…åå‘å‡çº§</span></span><br><span class="line">               (iso_level == IsolationLevel::READ_COMMITTED || iso_level == IsolationLevel::REPEATABLE_READ)) &#123;</span><br><span class="line">      <span class="keyword">auto</span> res =</span><br><span class="line">          exec_ctx_-&gt;<span class="built_in">GetLockManager</span>()-&gt;<span class="built_in">LockTable</span>(txn, LockManager::LockMode::INTENTION_SHARED, plan_-&gt;table_oid_);</span><br><span class="line">      <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor LockTable Failed&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="built_in">catch</span> (TransactionAbortException &amp;exception) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor LockTable Failed&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  iterator_ = std::<span class="built_in">make_unique</span>&lt;TableIterator&gt;(table_info_-&gt;table_-&gt;<span class="built_in">MakeEagerIterator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">SeqScanExecutor::Next</span><span class="params">(Tuple *tuple, RID *rid)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  std::pair&lt;TupleMeta, Tuple&gt; pair;</span><br><span class="line">  <span class="keyword">auto</span> txn = exec_ctx_-&gt;<span class="built_in">GetTransaction</span>();</span><br><span class="line">  <span class="keyword">auto</span> iso_level = txn-&gt;<span class="built_in">GetIsolationLevel</span>();</span><br><span class="line">  <span class="keyword">while</span> (!iterator_-&gt;<span class="built_in">IsEnd</span>()) &#123;</span><br><span class="line">    pair = iterator_-&gt;<span class="built_in">GetTuple</span>();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (exec_ctx_-&gt;<span class="built_in">IsDelete</span>()) &#123;</span><br><span class="line">        <span class="keyword">auto</span> res = exec_ctx_-&gt;<span class="built_in">GetLockManager</span>()-&gt;<span class="built_in">LockRow</span>(txn, LockManager::LockMode::EXCLUSIVE, plan_-&gt;table_oid_, pair.second.<span class="built_in">GetRid</span>());</span><br><span class="line">        <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor LockRow Failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!txn-&gt;<span class="built_in">IsRowExclusiveLocked</span>(plan_-&gt;table_oid_, pair.second.<span class="built_in">GetRid</span>()) &amp;&amp;  <span class="comment">// é¿å…åå‘å‡çº§</span></span><br><span class="line">                 (iso_level == IsolationLevel::READ_COMMITTED || iso_level == IsolationLevel::REPEATABLE_READ)) &#123;</span><br><span class="line">        <span class="keyword">auto</span> res = exec_ctx_-&gt;<span class="built_in">GetLockManager</span>()-&gt;<span class="built_in">LockRow</span>(txn, LockManager::LockMode::SHARED, plan_-&gt;table_oid_, pair.second.<span class="built_in">GetRid</span>());</span><br><span class="line">        <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor LockRow Failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (TransactionAbortException &amp;exception) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor LockRow Failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (iterator_-&gt;<span class="built_in">GetTuple</span>().first.is_deleted_ ||</span><br><span class="line">        (plan_-&gt;filter_predicate_ &amp;&amp;</span><br><span class="line">         plan_-&gt;filter_predicate_-&gt;<span class="built_in">Evaluate</span>(&amp;pair.second, table_info_-&gt;schema_)</span><br><span class="line">                 .<span class="built_in">CompareEquals</span>(ValueFactory::<span class="built_in">GetBooleanValue</span>(<span class="literal">false</span>)) == CmpBool::CmpTrue)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (exec_ctx_-&gt;<span class="built_in">IsDelete</span>() ||</span><br><span class="line">          (iso_level == IsolationLevel::READ_COMMITTED || iso_level == IsolationLevel::REPEATABLE_READ)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">auto</span> res = exec_ctx_-&gt;<span class="built_in">GetLockManager</span>()-&gt;<span class="built_in">UnlockRow</span>(txn, plan_-&gt;table_oid_, pair.second.<span class="built_in">GetRid</span>(), <span class="literal">true</span>);</span><br><span class="line">          <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor Force UnLockRow Failed&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="built_in">catch</span> (TransactionAbortException &amp;exception) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor Force UnLockRow Failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ++(*iterator_);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!exec_ctx_-&gt;<span class="built_in">IsDelete</span>() &amp;&amp; iso_level == IsolationLevel::READ_COMMITTED) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">auto</span> res = exec_ctx_-&gt;<span class="built_in">GetLockManager</span>()-&gt;<span class="built_in">UnlockRow</span>(txn, plan_-&gt;table_oid_, pair.second.<span class="built_in">GetRid</span>());</span><br><span class="line">        <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor UnLockRow Failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="built_in">catch</span> (TransactionAbortException &amp;exception) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor UnLockRow Failed&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++(*iterator_);</span><br><span class="line">    *tuple = std::<span class="built_in">move</span>(pair.second);</span><br><span class="line">    *rid = tuple-&gt;<span class="built_in">GetRid</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!exec_ctx_-&gt;<span class="built_in">IsDelete</span>() &amp;&amp; iso_level == IsolationLevel::READ_COMMITTED) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">auto</span> res = exec_ctx_-&gt;<span class="built_in">GetLockManager</span>()-&gt;<span class="built_in">UnlockTable</span>(txn, plan_-&gt;table_oid_);</span><br><span class="line">      <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor UnLockTable Failed&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (TransactionAbortException &amp;exception) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;SeqScanExecutor UnLockTable Failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>InsertExecutorä¿®æ”¹ï¼Œç»™tableåŠ IEé”ï¼Œå¹¶ä¸”tableå’Œindexæ’å…¥è®°å½•éœ€è¦è¢«ä¿å­˜ä¸‹æ¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">InsertExecutor::Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  child_executor_-&gt;<span class="built_in">Init</span>();</span><br><span class="line">  <span class="keyword">auto</span> cata_log = exec_ctx_-&gt;<span class="built_in">GetCatalog</span>();</span><br><span class="line">  table_info_ = cata_log-&gt;<span class="built_in">GetTable</span>(plan_-&gt;table_oid_);</span><br><span class="line">  index_infos_ = cata_log-&gt;<span class="built_in">GetTableIndexes</span>(table_info_-&gt;name_);</span><br><span class="line">  successful_ = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">auto</span> txn = exec_ctx_-&gt;<span class="built_in">GetTransaction</span>();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">auto</span> res =</span><br><span class="line">        exec_ctx_-&gt;<span class="built_in">GetLockManager</span>()-&gt;<span class="built_in">LockTable</span>(txn, LockManager::LockMode::INTENTION_EXCLUSIVE, plan_-&gt;table_oid_);</span><br><span class="line">    <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;InsertExecutor LockTable Failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="built_in">catch</span> (TransactionAbortException &amp;exception) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">ExecutionException</span>(<span class="string">&quot;InsertExecutor LockTable Failed&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">InsertExecutor::Next</span><span class="params">(Tuple *tuple, RID *rid)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  TupleMeta meta;</span><br><span class="line">  <span class="keyword">if</span> (successful_) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  meta.insert_txn_id_ = INVALID_TXN_ID;</span><br><span class="line">  meta.delete_txn_id_ = INVALID_TXN_ID;</span><br><span class="line">  meta.is_deleted_ = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">auto</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (child_executor_-&gt;<span class="built_in">Next</span>(tuple, rid)) &#123;</span><br><span class="line">    <span class="keyword">auto</span> tuple_rid = table_info_-&gt;table_-&gt;<span class="built_in">InsertTuple</span>(meta, *tuple, exec_ctx_-&gt;<span class="built_in">GetLockManager</span>(), exec_ctx_-&gt;<span class="built_in">GetTransaction</span>(), table_info_-&gt;oid_);</span><br><span class="line">    <span class="keyword">if</span> (tuple_rid == std::<span class="literal">nullopt</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">auto</span> twr = <span class="built_in">TableWriteRecord</span>(table_info_-&gt;oid_, tuple_rid.<span class="built_in">value</span>(), table_info_-&gt;table_.<span class="built_in">get</span>());</span><br><span class="line">    twr.wtype_ = WType::INSERT;</span><br><span class="line">    exec_ctx_-&gt;<span class="built_in">GetTransaction</span>()-&gt;<span class="built_in">GetWriteSet</span>()-&gt;<span class="built_in">push_back</span>(twr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> index_info : index_infos_) &#123;</span><br><span class="line">      <span class="keyword">auto</span> key = tuple-&gt;<span class="built_in">KeyFromTuple</span>(table_info_-&gt;schema_, index_info-&gt;key_schema_, index_info-&gt;index_-&gt;<span class="built_in">GetKeyAttrs</span>());</span><br><span class="line">      index_info-&gt;index_-&gt;<span class="built_in">InsertEntry</span>(key, *tuple_rid, exec_ctx_-&gt;<span class="built_in">GetTransaction</span>());</span><br><span class="line">      <span class="keyword">auto</span> iwr = <span class="built_in">IndexWriteRecord</span>(tuple_rid.<span class="built_in">value</span>(), table_info_-&gt;oid_, WType::INSERT, key, index_info-&gt;index_oid_,</span><br><span class="line">                                  exec_ctx_-&gt;<span class="built_in">GetCatalog</span>());</span><br><span class="line">      exec_ctx_-&gt;<span class="built_in">GetTransaction</span>()-&gt;<span class="built_in">GetIndexWriteSet</span>()-&gt;<span class="built_in">push_back</span>(iwr);</span><br><span class="line">    &#125;</span><br><span class="line">    ++count;</span><br><span class="line">  &#125;</span><br><span class="line">  std::vector&lt;Value&gt; values;</span><br><span class="line">  values.<span class="built_in">emplace_back</span>(TypeId::INTEGER, count);</span><br><span class="line">  *tuple = <span class="built_in">Tuple</span>(values, &amp;<span class="built_in">GetOutputSchema</span>());</span><br><span class="line">  successful_ = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DeleteExecutorä¿®æ”¹ï¼Œå¹¶ä¸”tableå’Œindexåˆ é™¤è®°å½•éœ€è¦è¢«ä¿å­˜ä¸‹æ¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">DeleteExecutor::Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  child_executor_-&gt;<span class="built_in">Init</span>();</span><br><span class="line">  successful_ = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">auto</span> catalog = exec_ctx_-&gt;<span class="built_in">GetCatalog</span>();</span><br><span class="line">  table_info_ = catalog-&gt;<span class="built_in">GetTable</span>(plan_-&gt;<span class="built_in">TableOid</span>());</span><br><span class="line">  index_infos_ = catalog-&gt;<span class="built_in">GetTableIndexes</span>(table_info_-&gt;name_);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">DeleteExecutor::Next</span><span class="params">(Tuple *tuple, RID *rid)</span> -&gt; <span class="type">bool</span> </span>&#123;</span><br><span class="line">  TupleMeta tuple_meta;</span><br><span class="line">  <span class="keyword">if</span> (successful_) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  tuple_meta.delete_txn_id_ = INVALID_TXN_ID;</span><br><span class="line">  tuple_meta.insert_txn_id_ = INVALID_TXN_ID;</span><br><span class="line">  tuple_meta.is_deleted_ = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">auto</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (child_executor_-&gt;<span class="built_in">Next</span>(tuple, rid)) &#123;</span><br><span class="line">    table_info_-&gt;table_-&gt;<span class="built_in">UpdateTupleMeta</span>(tuple_meta, *rid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> twr = <span class="built_in">TableWriteRecord</span>(table_info_-&gt;oid_, *rid, table_info_-&gt;table_.<span class="built_in">get</span>());</span><br><span class="line">    twr.wtype_ = WType::DELETE;</span><br><span class="line">    exec_ctx_-&gt;<span class="built_in">GetTransaction</span>()-&gt;<span class="built_in">GetWriteSet</span>()-&gt;<span class="built_in">push_back</span>(twr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> index_info : index_infos_) &#123;</span><br><span class="line">      <span class="keyword">auto</span> key = tuple-&gt;<span class="built_in">KeyFromTuple</span>(table_info_-&gt;schema_, index_info-&gt;key_schema_, index_info-&gt;index_-&gt;<span class="built_in">GetKeyAttrs</span>());</span><br><span class="line">      index_info-&gt;index_-&gt;<span class="built_in">DeleteEntry</span>(key, *rid, exec_ctx_-&gt;<span class="built_in">GetTransaction</span>());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">auto</span> iwr = <span class="built_in">IndexWriteRecord</span>(*rid, table_info_-&gt;oid_, WType::DELETE, key, index_info-&gt;index_oid_,</span><br><span class="line">                                  exec_ctx_-&gt;<span class="built_in">GetCatalog</span>());</span><br><span class="line">      exec_ctx_-&gt;<span class="built_in">GetTransaction</span>()-&gt;<span class="built_in">GetIndexWriteSet</span>()-&gt;<span class="built_in">push_back</span>(iwr);</span><br><span class="line">    &#125;</span><br><span class="line">    count++;</span><br><span class="line">  &#125;</span><br><span class="line">  std::vector&lt;Value&gt; values;</span><br><span class="line">  values.<span class="built_in">emplace_back</span>(TypeId::INTEGER, count);</span><br><span class="line">  *tuple = <span class="built_in">Tuple</span>(values, &amp;<span class="built_in">GetOutputSchema</span>());</span><br><span class="line">  successful_ = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äº”ç§ç»†ç²’åº¦é”IS IX S SIX Xç›¸å®¹çŸ©é˜µ</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">IS</th>
<th align="center">IX</th>
<th align="center">S</th>
<th align="center">SIX</th>
<th align="center">X</th>
</tr>
</thead>
<tbody><tr>
<td align="center">IS</td>
<td align="center">YES</td>
<td align="center">YES</td>
<td align="center">YES</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr>
<td align="center">IX</td>
<td align="center">YES</td>
<td align="center">YES</td>
<td align="center">NO</td>
<td align="center">NO</td>
<td align="center">NO</td>
</tr>
<tr>
<td align="center">S</td>
<td align="center">YES</td>
<td align="center">NO</td>
<td align="center">YES</td>
<td align="center">NO</td>
<td align="center">NO</td>
</tr>
<tr>
<td align="center">SIX</td>
<td align="center">YES</td>
<td align="center">NO</td>
<td align="center">NO</td>
<td align="center">NO</td>
<td align="center">NO</td>
</tr>
<tr>
<td align="center">X</td>
<td align="center">NO</td>
<td align="center">NO</td>
<td align="center">NO</td>
<td align="center">NO</td>
<td align="center">NO</td>
</tr>
</tbody></table>
<p>æœ¬åœ°æµ‹è¯•é€šè¿‡ï¼š<br><img src="/../images/cmu15445-project4/14.png" alt="img"><br><img src="/../images/cmu15445-project4/15.png" alt="img"><br><img src="/../images/cmu15445-project4/16.png" alt="img"><br><img src="/../images/cmu15445-project4/17.png" alt="img"><br><img src="/../images/cmu15445-project4/18.png" alt="img"></p>
<p>çº¿ä¸Šæµ‹è¯•é€šè¿‡:<br><img src="/../images/cmu15445-project4/19.png" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="jingtao8a"
      src="/images/iverson.jpg">
  <p class="site-author-name" itemprop="name">jingtao8a</p>
  <div class="site-description" itemprop="description">this is life, full of ups and down</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jingtao8a</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
